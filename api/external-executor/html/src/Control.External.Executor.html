<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | Executor for external tasks.</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">--   An executor will poll for tasks on the co-ordinator, mark them as in</span><span>
</span><span id="line-10"></span><span class="hs-comment">--   progress and then execute them.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">--   You probably want to start with 'executeLoop'.</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.External.Executor</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/ibn7j489xcbkag2znd9qmdib50z1nnng-hspec-core-lib-hspec-core-2.7.4-haddock-doc/share/doc/hspec-core/html/src"><span class="hs-identifier">Control.Concurrent.Async</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.MVar</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/klpzhh530yhcxi2n0gkxsd4vh5zs5z8s-safe-exceptions-lib-safe-exceptions-0.1.7.1-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier">Control.Exception.Safe</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.External.html"><span class="hs-identifier">Control.External</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.External.Coordinator.html"><span class="hs-identifier">Control.External.Coordinator</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forever</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mzero</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/ryw2lq174yy3x70q5bcnbam29fdf5prf-aeson-lib-aeson-1.4.7.1-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Json</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier">Data.CAS.ContentStore</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CS</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier">Data.CAS.RemoteCache</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Remote</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">for_</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.IO.Handle</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hClose</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier">Katip</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">K</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/z6i98d27j4l05nfcjlmrk1yabp9rhqcl-hostname-lib-hostname-1.0-haddock-doc/share/doc/hostname/html/src"><span class="hs-identifier">Network.HostName</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-identifier">Path</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/29hxzlip96mlvhzzln0baiws85977sln-path-io-lib-path-io-1.6.0-haddock-doc/share/doc/path-io/html/src"><span class="hs-identifier">Path.IO</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier">System.Clock</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Exit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExitCode</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Handle</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-identifier">IOMode</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-identifier">openFile</span></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-identifier">stdout</span></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.Env</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Posix.User</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="ExecutionResult"><span class="annot"><a href="Control.External.Executor.html#ExecutionResult"><span class="hs-identifier hs-var">ExecutionResult</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | The result already exists in the store and there is no need</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">--   to execute. This is also returned if the job is already running</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">--   elsewhere.</span><span>
</span><span id="line-55"></span><span>    </span><span id="Cached"><span class="annot"><a href="Control.External.Executor.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The computation is already running elsewhere. This is probably</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-comment">--   indicative of a bug, because the coordinator should only allow one</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">--   instance of a task to be running at any time.</span><span>
</span><span id="line-59"></span><span>    </span><span id="AlreadyRunning"><span class="annot"><a href="Control.External.Executor.html#AlreadyRunning"><span class="hs-identifier hs-var">AlreadyRunning</span></a></span></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Execution completed successfully after a certain amount of time.</span><span>
</span><span id="line-61"></span><span>    </span><span id="Success"><span class="annot"><a href="Control.External.Executor.html#Success"><span class="hs-identifier hs-var">Success</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-type">TimeSpec</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Execution failed with the following exit code.</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-comment">--   TODO where should logs go?</span><span>
</span><span id="line-64"></span><span>    </span><span id="Failure"><span class="annot"><a href="Control.External.Executor.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-type">TimeSpec</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | The executor itself failed to execute the external task.</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">--   E.g. because the executable was not found.</span><span>
</span><span id="line-67"></span><span>    </span><span id="ExecutorFailure"><span class="annot"><a href="Control.External.Executor.html#ExecutorFailure"><span class="hs-identifier hs-var">ExecutorFailure</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOException</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | Execute an individual task.</span><span>
</span><span id="line-70"></span><span class="annot"><a href="Control.External.Executor.html#execute"><span class="hs-identifier hs-type">execute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.ContentStore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.External.html#TaskDescription"><span class="hs-identifier hs-type">TaskDescription</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-type">KatipContextT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Control.External.Executor.html#ExecutionResult"><span class="hs-identifier hs-type">ExecutionResult</span></a></span><span>
</span><span id="line-71"></span><span id="execute"><span class="annot"><span class="annottext">execute :: ContentStore -&gt; TaskDescription -&gt; KatipContextT IO ExecutionResult
</span><a href="Control.External.Executor.html#execute"><span class="hs-identifier hs-var hs-var">execute</span></a></span></span><span> </span><span id="local-6989586621679342913"><span class="annot"><span class="annottext">store :: ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679342912"><span class="annot"><span class="annottext">td :: TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KatipContextT IO ExecutionResult
-&gt; KatipContextT IO ExecutionResult
forall a. KatipContextT IO a -&gt; KatipContextT IO a
</span><a href="#local-6989586621679342911"><span class="hs-identifier hs-var">logError</span></a></span><span> </span><span class="annot"><span class="annottext">(KatipContextT IO ExecutionResult
 -&gt; KatipContextT IO ExecutionResult)
-&gt; KatipContextT IO ExecutionResult
-&gt; KatipContextT IO ExecutionResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-comment">-- We should pass a Remote cacher down to it:</span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621679342910"><span class="annot"><span class="annottext">Status
  (Either IOException (TimeSpec, Int)) () (Maybe TimeSpec, Item)
</span><a href="#local-6989586621679342910"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentStore
-&gt; NoCache
-&gt; KatipContextT IO ()
-&gt; ContentHash
-&gt; (Path Abs Dir
    -&gt; KatipContextT
         IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; KatipContextT
     IO
     (Status
        (Either IOException (TimeSpec, Int)) () (Maybe TimeSpec, Item))
forall (m :: * -&gt; *) remoteCache e a.
(MonadIO m, MonadUnliftIO m, MonadMask m, Cacher m remoteCache) =&gt;
ContentStore
-&gt; remoteCache
-&gt; m ()
-&gt; ContentHash
-&gt; (Path Abs Dir -&gt; m (Either e a))
-&gt; m (Status e () (Maybe a, Item))
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">CS.withConstructIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">NoCache
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">Remote.NoCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; KatipContextT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Path Abs Dir
  -&gt; KatipContextT
       IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
 -&gt; KatipContextT
      IO
      (Status
         (Either IOException (TimeSpec, Int)) () (Maybe TimeSpec, Item)))
-&gt; (Path Abs Dir
    -&gt; KatipContextT
         IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; KatipContextT
     IO
     (Status
        (Either IOException (TimeSpec, Int)) () (Maybe TimeSpec, Item))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679342905"><span class="annot"><span class="annottext">fp :: Path Abs Dir
</span><a href="#local-6989586621679342905"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679342904"><span class="annot"><span class="annottext">fpOut :: Path Abs File
</span><a href="#local-6989586621679342904"><span class="hs-identifier hs-var">fpOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679342903"><span class="annot"><span class="annottext">hOut :: Handle
</span><a href="#local-6989586621679342903"><span class="hs-identifier hs-var">hOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">IO (Path Abs File, Handle)
-&gt; KatipContextT IO (Path Abs File, Handle)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Path Abs File, Handle)
 -&gt; KatipContextT IO (Path Abs File, Handle))
-&gt; IO (Path Abs File, Handle)
-&gt; KatipContextT IO (Path Abs File, Handle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">ContentStore
-&gt; ContentHash -&gt; Path Rel File -&gt; IO (Path Abs File, Handle)
forall (m :: * -&gt; *).
MonadIO m =&gt;
ContentStore
-&gt; ContentHash -&gt; Path Rel File -&gt; m (Path Abs File, Handle)
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">CS.createMetadataFile</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="">[relfile|stdout|]</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679342900"><span class="annot"><span class="annottext">fpErr :: Path Abs File
</span><a href="#local-6989586621679342900"><span class="hs-identifier hs-var">fpErr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679342899"><span class="annot"><span class="annottext">hErr :: Handle
</span><a href="#local-6989586621679342899"><span class="hs-identifier hs-var">hErr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><span class="annottext">IO (Path Abs File, Handle)
-&gt; KatipContextT IO (Path Abs File, Handle)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Path Abs File, Handle)
 -&gt; KatipContextT IO (Path Abs File, Handle))
-&gt; IO (Path Abs File, Handle)
-&gt; KatipContextT IO (Path Abs File, Handle)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="annottext">ContentStore
-&gt; ContentHash -&gt; Path Rel File -&gt; IO (Path Abs File, Handle)
forall (m :: * -&gt; *).
MonadIO m =&gt;
ContentStore
-&gt; ContentHash -&gt; Path Rel File -&gt; m (Path Abs File, Handle)
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">CS.createMetadataFile</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="">[relfile|stderr|]</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679342898"><span class="annot"><span class="annottext">withFollowOutput :: IO a -&gt; IO a
</span><a href="#local-6989586621679342898"><span class="hs-identifier hs-var hs-var">withFollowOutput</span></a></span></span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span>
</span><span id="line-82"></span><span>              </span><span class="annot"><span class="annottext">TaskDescription -&gt; Getting Bool TaskDescription Bool -&gt; Bool
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; Const Bool ExternalTask)
-&gt; TaskDescription -&gt; Const Bool TaskDescription
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span> </span><span class="annot"><span class="annottext">((ExternalTask -&gt; Const Bool ExternalTask)
 -&gt; TaskDescription -&gt; Const Bool TaskDescription)
-&gt; ((Bool -&gt; Const Bool Bool)
    -&gt; ExternalTask -&gt; Const Bool ExternalTask)
-&gt; Getting Bool TaskDescription Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OutputCapture -&gt; Const Bool OutputCapture)
-&gt; ExternalTask -&gt; Const Bool ExternalTask
Lens' ExternalTask OutputCapture
</span><a href="Control.External.html#etWriteToStdOut"><span class="hs-identifier hs-var">etWriteToStdOut</span></a></span><span> </span><span class="annot"><span class="annottext">((OutputCapture -&gt; Const Bool OutputCapture)
 -&gt; ExternalTask -&gt; Const Bool ExternalTask)
-&gt; ((Bool -&gt; Const Bool Bool)
    -&gt; OutputCapture -&gt; Const Bool OutputCapture)
-&gt; (Bool -&gt; Const Bool Bool)
-&gt; ExternalTask
-&gt; Const Bool ExternalTask
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OutputCapture -&gt; Maybe (Path Rel File))
-&gt; Optic' (-&gt;) (Const Bool) OutputCapture (Maybe (Path Rel File))
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">OutputCapture -&gt; Maybe (Path Rel File)
</span><a href="Control.External.html#outputCaptureToRelFile"><span class="hs-identifier hs-var">outputCaptureToRelFile</span></a></span><span>
</span><span id="line-83"></span><span>                </span><span class="annot"><span class="annottext">Optic' (-&gt;) (Const Bool) OutputCapture (Maybe (Path Rel File))
-&gt; ((Bool -&gt; Const Bool Bool)
    -&gt; Maybe (Path Rel File) -&gt; Const Bool (Maybe (Path Rel File)))
-&gt; (Bool -&gt; Const Bool Bool)
-&gt; OutputCapture
-&gt; Const Bool OutputCapture
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Path Rel File) -&gt; Bool)
-&gt; (Bool -&gt; Const Bool Bool)
-&gt; Maybe (Path Rel File)
-&gt; Const Bool (Maybe (Path Rel File))
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Path Rel File) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>            </span><span class="annot"><span class="annottext">Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
forall a. Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
</span><a href="Control.External.Executor.html#withFollowFile"><span class="hs-identifier hs-var">withFollowFile</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs File
</span><a href="#local-6989586621679342900"><span class="hs-identifier hs-var">fpErr</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span>
</span><span id="line-85"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><span class="annottext">Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
forall a. Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
</span><a href="Control.External.Executor.html#withFollowFile"><span class="hs-identifier hs-var">withFollowFile</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs File
</span><a href="#local-6989586621679342900"><span class="hs-identifier hs-var">fpErr</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span>
</span><span id="line-87"></span><span>              </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; (IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
forall a. Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
</span><a href="Control.External.Executor.html#withFollowFile"><span class="hs-identifier hs-var">withFollowFile</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs File
</span><a href="#local-6989586621679342904"><span class="hs-identifier hs-var">fpOut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdout</span></span><span>
</span><span id="line-88"></span><span>        </span><span id="local-6989586621679342891"><span class="annot"><span class="annottext">cmd :: FilePath
</span><a href="#local-6989586621679342891"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath) -&gt; Text -&gt; FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription -&gt; Getting Text TaskDescription Text -&gt; Text
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; Const Text ExternalTask)
-&gt; TaskDescription -&gt; Const Text TaskDescription
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span> </span><span class="annot"><span class="annottext">((ExternalTask -&gt; Const Text ExternalTask)
 -&gt; TaskDescription -&gt; Const Text TaskDescription)
-&gt; ((Text -&gt; Const Text Text)
    -&gt; ExternalTask -&gt; Const Text ExternalTask)
-&gt; Getting Text TaskDescription Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Const Text Text)
-&gt; ExternalTask -&gt; Const Text ExternalTask
Lens' ExternalTask Text
</span><a href="Control.External.html#etCommand"><span class="hs-identifier hs-var">etCommand</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span id="local-6989586621679342888"><span class="annot"><span class="annottext">procSpec :: [Text] -&gt; Maybe [(Text, Text)] -&gt; CreateProcess
</span><a href="#local-6989586621679342888"><span class="hs-identifier hs-var hs-var">procSpec</span></a></span></span><span> </span><span id="local-6989586621679342887"><span class="annot"><span class="annottext">params :: [Text]
</span><a href="#local-6989586621679342887"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679342886"><span class="annot"><span class="annottext">textEnv :: Maybe [(Text, Text)]
</span><a href="#local-6989586621679342886"><span class="hs-identifier hs-var">textEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; CreateProcess
</span><span class="hs-identifier hs-var">proc</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679342891"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; CreateProcess) -&gt; [FilePath] -&gt; CreateProcess
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath) -&gt; [Text] -&gt; [FilePath]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679342887"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cwd :: Maybe FilePath
</span><span class="hs-identifier hs-var">cwd</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path Abs Dir -&gt; FilePath
</span><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-var">fromAbsDir</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs Dir
</span><a href="#local-6989586621679342905"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>              </span><span class="annot"><span class="annottext">close_fds :: Bool
</span><span class="hs-identifier hs-var">close_fds</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>              </span><span class="annot"><span class="annottext">std_err :: StdStream
</span><span class="hs-identifier hs-var">std_err</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; StdStream
</span><span class="hs-identifier hs-var">UseHandle</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342899"><span class="hs-identifier hs-var">hErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>              </span><span class="annot"><span class="annottext">std_out :: StdStream
</span><span class="hs-identifier hs-var">std_out</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; StdStream
</span><span class="hs-identifier hs-var">UseHandle</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342903"><span class="hs-identifier hs-var">hOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>              </span><span class="annot"><span class="annottext">env :: Maybe [(FilePath, FilePath)]
</span><span class="hs-identifier hs-var">env</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Text, Text) -&gt; (FilePath, FilePath))
-&gt; [(Text, Text)] -&gt; [(FilePath, FilePath)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; FilePath)
-&gt; (Text -&gt; FilePath) -&gt; (Text, Text) -&gt; (FilePath, FilePath)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Text, Text)] -&gt; [(FilePath, FilePath)])
-&gt; Maybe [(Text, Text)] -&gt; Maybe [(FilePath, FilePath)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe [(Text, Text)]
</span><a href="#local-6989586621679342886"><span class="hs-identifier hs-var">textEnv</span></a></span><span>
</span><span id="line-96"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>        </span><span id="local-6989586621679342875"><span class="annot"><span class="annottext">convParam :: ConvParam (MaybeT IO)
</span><a href="#local-6989586621679342875"><span class="hs-identifier hs-var hs-var">convParam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>          </span><span class="annot"><span class="annottext">ConvParam :: forall (f :: * -&gt; *).
(Item -&gt; f (Path Abs Dir))
-&gt; (Text -&gt; f Text)
-&gt; f CUid
-&gt; f CGid
-&gt; f (Path Abs Dir)
-&gt; ConvParam f
</span><a href="Control.External.html#ConvParam"><span class="hs-identifier hs-type hs-type">ConvParam</span></a></span><span>
</span><span id="line-99"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">convPath :: Item -&gt; MaybeT IO (Path Abs Dir)
</span><a href="Control.External.html#convPath"><span class="hs-identifier hs-var">convPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path Abs Dir -&gt; MaybeT IO (Path Abs Dir)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Path Abs Dir -&gt; MaybeT IO (Path Abs Dir))
-&gt; (Item -&gt; Path Abs Dir) -&gt; Item -&gt; MaybeT IO (Path Abs Dir)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ContentStore -&gt; Item -&gt; Path Abs Dir
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">CS.itemPath</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>              </span><span class="annot"><span class="annottext">convEnv :: Text -&gt; MaybeT IO Text
</span><a href="Control.External.html#convEnv"><span class="hs-identifier hs-var">convEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679342869"><span class="annot"><span class="annottext">e :: Text
</span><a href="#local-6989586621679342869"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; MaybeT IO FilePath -&gt; MaybeT IO Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe FilePath) -&gt; MaybeT IO FilePath
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><span class="hs-identifier hs-var">MaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe FilePath)
</span><span class="hs-identifier hs-var">getEnv</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO (Maybe FilePath))
-&gt; FilePath -&gt; IO (Maybe FilePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679342869"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>              </span><span class="annot"><span class="annottext">convUid :: MaybeT IO CUid
</span><a href="Control.External.html#convUid"><span class="hs-identifier hs-var">convUid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CUid -&gt; MaybeT IO CUid
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">IO CUid
</span><span class="hs-identifier hs-var">getEffectiveUserID</span></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>              </span><span class="annot"><span class="annottext">convGid :: MaybeT IO CGid
</span><a href="Control.External.html#convGid"><span class="hs-identifier hs-var">convGid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO CGid -&gt; MaybeT IO CGid
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">IO CGid
</span><span class="hs-identifier hs-var">getEffectiveGroupID</span></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>              </span><span class="annot"><span class="annottext">convOut :: MaybeT IO (Path Abs Dir)
</span><a href="Control.External.html#convOut"><span class="hs-identifier hs-var">convOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path Abs Dir -&gt; MaybeT IO (Path Abs Dir)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Path Abs Dir
</span><a href="#local-6989586621679342905"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679342861"><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679342861"><span class="hs-identifier hs-var">mbParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><span class="annottext">IO (Maybe [Text]) -&gt; KatipContextT IO (Maybe [Text])
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe [Text]) -&gt; KatipContextT IO (Maybe [Text]))
-&gt; IO (Maybe [Text]) -&gt; KatipContextT IO (Maybe [Text])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">MaybeT IO [Text] -&gt; IO (Maybe [Text])
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO [Text] -&gt; IO (Maybe [Text]))
-&gt; MaybeT IO [Text] -&gt; IO (Maybe [Text])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-108"></span><span>          </span><span class="annot"><span class="annottext">(Param -&gt; MaybeT IO Text) -&gt; [Param] -&gt; MaybeT IO [Text]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConvParam (MaybeT IO) -&gt; Param -&gt; MaybeT IO Text
forall (f :: * -&gt; *).
Applicative f =&gt;
ConvParam f -&gt; Param -&gt; f Text
</span><a href="Control.External.html#paramToText"><span class="hs-identifier hs-var">paramToText</span></a></span><span> </span><span class="annot"><span class="annottext">ConvParam (MaybeT IO)
</span><a href="#local-6989586621679342875"><span class="hs-identifier hs-var">convParam</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting [Param] TaskDescription [Param] -&gt; [Param]
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; Const [Param] ExternalTask)
-&gt; TaskDescription -&gt; Const [Param] TaskDescription
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span> </span><span class="annot"><span class="annottext">((ExternalTask -&gt; Const [Param] ExternalTask)
 -&gt; TaskDescription -&gt; Const [Param] TaskDescription)
-&gt; (([Param] -&gt; Const [Param] [Param])
    -&gt; ExternalTask -&gt; Const [Param] ExternalTask)
-&gt; Getting [Param] TaskDescription [Param]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Param] -&gt; Const [Param] [Param])
-&gt; ExternalTask -&gt; Const [Param] ExternalTask
Lens' ExternalTask [Param]
</span><a href="Control.External.html#etParams"><span class="hs-identifier hs-var">etParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679342856"><span class="annot"><span class="annottext">Maybe [(Text, Text)]
</span><a href="#local-6989586621679342856"><span class="hs-identifier hs-var">mbEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription -&gt; Getting Env TaskDescription Env -&gt; Env
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; Const Env ExternalTask)
-&gt; TaskDescription -&gt; Const Env TaskDescription
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span> </span><span class="annot"><span class="annottext">((ExternalTask -&gt; Const Env ExternalTask)
 -&gt; TaskDescription -&gt; Const Env TaskDescription)
-&gt; ((Env -&gt; Const Env Env)
    -&gt; ExternalTask -&gt; Const Env ExternalTask)
-&gt; Getting Env TaskDescription Env
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Env -&gt; Const Env Env) -&gt; ExternalTask -&gt; Const Env ExternalTask
Lens' ExternalTask Env
</span><a href="Control.External.html#etEnv"><span class="hs-identifier hs-var">etEnv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="Control.External.html#EnvInherit"><span class="hs-identifier hs-type">EnvInherit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [(Text, Text)] -&gt; KatipContextT IO (Maybe [(Text, Text)])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe [(Text, Text)]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><a href="Control.External.html#EnvExplicit"><span class="hs-identifier hs-type">EnvExplicit</span></a></span><span> </span><span id="local-6989586621679342852"><span class="annot"><span class="annottext">x :: [(Text, Param)]
</span><a href="#local-6989586621679342852"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe [(Text, Text)])
-&gt; KatipContextT IO (Maybe [(Text, Text)])
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe [(Text, Text)])
 -&gt; KatipContextT IO (Maybe [(Text, Text)]))
-&gt; (MaybeT IO [(Text, Text)] -&gt; IO (Maybe [(Text, Text)]))
-&gt; MaybeT IO [(Text, Text)]
-&gt; KatipContextT IO (Maybe [(Text, Text)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">MaybeT IO [(Text, Text)] -&gt; IO (Maybe [(Text, Text)])
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO [(Text, Text)]
 -&gt; KatipContextT IO (Maybe [(Text, Text)]))
-&gt; MaybeT IO [(Text, Text)]
-&gt; KatipContextT IO (Maybe [(Text, Text)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Text, Param) -&gt; MaybeT IO (Text, Text))
-&gt; [(Text, Param)] -&gt; MaybeT IO [(Text, Text)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text, MaybeT IO Text) -&gt; MaybeT IO (Text, Text)
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">((Text, MaybeT IO Text) -&gt; MaybeT IO (Text, Text))
-&gt; ((Text, Param) -&gt; (Text, MaybeT IO Text))
-&gt; (Text, Param)
-&gt; MaybeT IO (Text, Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Param -&gt; MaybeT IO Text)
-&gt; (Text, Param) -&gt; (Text, MaybeT IO Text)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConvParam (MaybeT IO) -&gt; Param -&gt; MaybeT IO Text
forall (f :: * -&gt; *).
Applicative f =&gt;
ConvParam f -&gt; Param -&gt; f Text
</span><a href="Control.External.html#paramToText"><span class="hs-identifier hs-var">paramToText</span></a></span><span> </span><span class="annot"><span class="annottext">ConvParam (MaybeT IO)
</span><a href="#local-6989586621679342875"><span class="hs-identifier hs-var">convParam</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, Param)]
</span><a href="#local-6989586621679342852"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>          </span><span class="annot"><span class="annottext">KatipContextT IO (Maybe [(Text, Text)])
-&gt; (Maybe [(Text, Text)]
    -&gt; KatipContextT IO (Maybe [(Text, Text)]))
-&gt; KatipContextT IO (Maybe [(Text, Text)])
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; KatipContextT IO (Maybe [(Text, Text)])
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="hs-string">&quot;A parameter was not ready&quot;</span></span><span>
</span><span id="line-115"></span><span>            </span><span id="local-6989586621679342850"><span class="annot"><span class="annottext">jp :: Maybe [(Text, Text)]
</span><a href="#local-6989586621679342850"><span class="hs-identifier hs-var">jp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [(Text, Text)] -&gt; KatipContextT IO (Maybe [(Text, Text)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe [(Text, Text)]
</span><a href="#local-6989586621679342850"><span class="hs-identifier hs-var">jp</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679342849"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679342849"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [Text]
</span><a href="#local-6989586621679342861"><span class="hs-identifier hs-var">mbParams</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; KatipContextT IO [Text]
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="hs-string">&quot;A parameter was not ready&quot;</span></span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679342848"><span class="annot"><span class="annottext">params :: [Text]
</span><a href="#local-6989586621679342848"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; KatipContextT IO [Text]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679342848"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679342847"><span class="hs-identifier hs-type">inputItems</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.Item</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679342847"><span class="annot"><span class="annottext">inputItems :: [Item]
</span><a href="#local-6989586621679342847"><span class="hs-identifier hs-var hs-var">inputItems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>          </span><span class="annot"><a href="Control.External.html#Param"><span class="hs-identifier hs-type">Param</span></a></span><span> </span><span id="local-6989586621679342845"><span class="annot"><span class="annottext">fields :: [ParamField]
</span><a href="#local-6989586621679342845"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting [Param] TaskDescription [Param] -&gt; [Param]
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; Const [Param] ExternalTask)
-&gt; TaskDescription -&gt; Const [Param] TaskDescription
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span> </span><span class="annot"><span class="annottext">((ExternalTask -&gt; Const [Param] ExternalTask)
 -&gt; TaskDescription -&gt; Const [Param] TaskDescription)
-&gt; (([Param] -&gt; Const [Param] [Param])
    -&gt; ExternalTask -&gt; Const [Param] ExternalTask)
-&gt; Getting [Param] TaskDescription [Param]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Param] -&gt; Const [Param] [Param])
-&gt; ExternalTask -&gt; Const [Param] ExternalTask
Lens' ExternalTask [Param]
</span><a href="Control.External.html#etParams"><span class="hs-identifier hs-var">etParams</span></a></span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><a href="Control.External.html#ParamPath"><span class="hs-identifier hs-type">ParamPath</span></a></span><span> </span><span id="local-6989586621679342843"><span class="annot"><span class="annottext">inputPath :: InputPath
</span><a href="#local-6989586621679342843"><span class="hs-identifier hs-var">inputPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ParamField]
</span><a href="#local-6989586621679342845"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-123"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InputPath
</span><a href="#local-6989586621679342843"><span class="hs-identifier hs-var">inputPath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><a href="Control.External.html#IPItem"><span class="hs-identifier hs-type">IPItem</span></a></span><span> </span><span id="local-6989586621679342841"><span class="annot"><span class="annottext">item :: Item
</span><a href="#local-6989586621679342841"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Item -&gt; [Item]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Item
</span><a href="#local-6989586621679342841"><span class="hs-identifier hs-var">item</span></a></span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-comment">-- XXX: Store these references as well.</span><span>
</span><span id="line-126"></span><span>            </span><span class="annot"><a href="Control.External.html#IPExternalFile"><span class="hs-identifier hs-type">IPExternalFile</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Item]
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><a href="Control.External.html#IPExternalDir"><span class="hs-identifier hs-type">IPExternalDir</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Item]
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">ContentStore -&gt; ContentHash -&gt; [Item] -&gt; KatipContextT IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
ContentStore -&gt; ContentHash -&gt; [Item] -&gt; m ()
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">CS.setInputs</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Item]
</span><a href="#local-6989586621679342847"><span class="hs-identifier hs-var">inputItems</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">ContentStore
-&gt; ContentHash -&gt; Text -&gt; ByteString -&gt; KatipContextT IO ()
forall k v (m :: * -&gt; *).
(ToField k, ToField v, MonadIO m) =&gt;
ContentStore -&gt; ContentHash -&gt; k -&gt; v -&gt; m ()
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">CS.setMetadata</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342913"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;external-task&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalTask -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../file:///nix/store/ryw2lq174yy3x70q5bcnbam29fdf5prf-aeson-lib-aeson-1.4.7.1-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">Json.encode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ExternalTask TaskDescription ExternalTask
-&gt; ExternalTask
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ExternalTask TaskDescription ExternalTask
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679342835"><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342835"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO TimeSpec -&gt; KatipContextT IO TimeSpec
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO TimeSpec -&gt; KatipContextT IO TimeSpec)
-&gt; IO TimeSpec -&gt; KatipContextT IO TimeSpec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clock -&gt; IO TimeSpec
</span><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">getTime</span></a></span><span> </span><span class="annot"><span class="annottext">Clock
</span><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">Monotonic</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679342832"><span class="annot"><span class="annottext">theProc :: CreateProcess
</span><a href="#local-6989586621679342832"><span class="hs-identifier hs-var hs-var">theProc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Maybe [(Text, Text)] -&gt; CreateProcess
</span><a href="#local-6989586621679342888"><span class="hs-identifier hs-var">procSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679342849"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [(Text, Text)]
</span><a href="#local-6989586621679342856"><span class="hs-identifier hs-var">mbEnv</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">Namespace
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall (m :: * -&gt; *) a. KatipContext m =&gt; Namespace -&gt; m a -&gt; m a
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">katipAddNamespace</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;process&quot;</span></span><span> </span><span class="annot"><span class="annottext">(KatipContextT
   IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
 -&gt; KatipContextT
      IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; (KatipContextT
      IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
    -&gt; KatipContextT
         IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SimpleLogPayload
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall i (m :: * -&gt; *) a.
(LogItem i, KatipContext m) =&gt;
i -&gt; m a -&gt; m a
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">katipAddContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FilePath -&gt; SimpleLogPayload
forall a. ToJSON a =&gt; Text -&gt; a -&gt; SimpleLogPayload
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;processId&quot;</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; SimpleLogPayload) -&gt; FilePath -&gt; SimpleLogPayload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CreateProcess -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679342832"><span class="hs-identifier hs-var">theProc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KatipContextT
   IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
 -&gt; KatipContextT
      IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">InfoS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Executing&quot;</span></span><span>
</span><span id="line-138"></span><span>      </span><span id="local-6989586621679342824"><span class="annot"><span class="annottext">Either IOException (Either (TimeSpec, Int) TimeSpec)
</span><a href="#local-6989586621679342824"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
-&gt; KatipContextT
     IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
 -&gt; KatipContextT
      IO (Either IOException (Either (TimeSpec, Int) TimeSpec)))
-&gt; IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
-&gt; KatipContextT
     IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">IO (Either (TimeSpec, Int) TimeSpec)
-&gt; IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
m a -&gt; m (Either IOException a)
</span><a href="../file:///nix/store/klpzhh530yhcxi2n0gkxsd4vh5zs5z8s-safe-exceptions-lib-safe-exceptions-0.1.7.1-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either (TimeSpec, Int) TimeSpec)
 -&gt; IO (Either IOException (Either (TimeSpec, Int) TimeSpec)))
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
-&gt; IO (Either IOException (Either (TimeSpec, Int) TimeSpec))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-140"></span><span>          </span><span class="annot"><span class="annottext">CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle
    -&gt; Maybe Handle
    -&gt; ProcessHandle
    -&gt; IO (Either (TimeSpec, Int) TimeSpec))
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall a.
CreateProcess
-&gt; (Maybe Handle
    -&gt; Maybe Handle -&gt; Maybe Handle -&gt; ProcessHandle -&gt; IO a)
-&gt; IO a
</span><span class="hs-identifier hs-var">withCreateProcess</span></span><span> </span><span class="annot"><span class="annottext">CreateProcess
</span><a href="#local-6989586621679342832"><span class="hs-identifier hs-var">theProc</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Handle
  -&gt; Maybe Handle
  -&gt; Maybe Handle
  -&gt; ProcessHandle
  -&gt; IO (Either (TimeSpec, Int) TimeSpec))
 -&gt; IO (Either (TimeSpec, Int) TimeSpec))
-&gt; (Maybe Handle
    -&gt; Maybe Handle
    -&gt; Maybe Handle
    -&gt; ProcessHandle
    -&gt; IO (Either (TimeSpec, Int) TimeSpec))
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679342821"><span class="annot"><span class="annottext">ph :: ProcessHandle
</span><a href="#local-6989586621679342821"><span class="hs-identifier hs-var">ph</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-comment">-- Error output should be displayed on our stderr stream</span><span>
</span><span id="line-142"></span><span>            </span><span class="annot"><span class="annottext">IO (Either (TimeSpec, Int) TimeSpec)
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall a. IO a -&gt; IO a
</span><a href="#local-6989586621679342898"><span class="hs-identifier hs-var">withFollowOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either (TimeSpec, Int) TimeSpec)
 -&gt; IO (Either (TimeSpec, Int) TimeSpec))
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>              </span><span id="local-6989586621679342820"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679342820"><span class="hs-identifier hs-var">exitCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProcessHandle -&gt; IO ExitCode
</span><span class="hs-identifier hs-var">waitForProcess</span></span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><a href="#local-6989586621679342821"><span class="hs-identifier hs-var">ph</span></a></span><span>
</span><span id="line-144"></span><span>              </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342899"><span class="hs-identifier hs-var">hErr</span></a></span><span>
</span><span id="line-145"></span><span>              </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342903"><span class="hs-identifier hs-var">hOut</span></a></span><span>
</span><span id="line-146"></span><span>              </span><span id="local-6989586621679342818"><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342818"><span class="hs-identifier hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Clock -&gt; IO TimeSpec
</span><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">getTime</span></a></span><span> </span><span class="annot"><span class="annottext">Clock
</span><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">Monotonic</span></a></span><span>
</span><span id="line-147"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679342820"><span class="hs-identifier hs-var">exitCode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-148"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">ExitSuccess</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (Path Rel File) -&gt; (Path Rel File -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342912"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting
     (Maybe (Path Rel File)) TaskDescription (Maybe (Path Rel File))
-&gt; Maybe (Path Rel File)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; Const (Maybe (Path Rel File)) ExternalTask)
-&gt; TaskDescription -&gt; Const (Maybe (Path Rel File)) TaskDescription
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span> </span><span class="annot"><span class="annottext">((ExternalTask -&gt; Const (Maybe (Path Rel File)) ExternalTask)
 -&gt; TaskDescription
 -&gt; Const (Maybe (Path Rel File)) TaskDescription)
-&gt; ((Maybe (Path Rel File)
     -&gt; Const (Maybe (Path Rel File)) (Maybe (Path Rel File)))
    -&gt; ExternalTask -&gt; Const (Maybe (Path Rel File)) ExternalTask)
-&gt; Getting
     (Maybe (Path Rel File)) TaskDescription (Maybe (Path Rel File))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OutputCapture -&gt; Const (Maybe (Path Rel File)) OutputCapture)
-&gt; ExternalTask -&gt; Const (Maybe (Path Rel File)) ExternalTask
Lens' ExternalTask OutputCapture
</span><a href="Control.External.html#etWriteToStdOut"><span class="hs-identifier hs-var">etWriteToStdOut</span></a></span><span> </span><span class="annot"><span class="annottext">((OutputCapture -&gt; Const (Maybe (Path Rel File)) OutputCapture)
 -&gt; ExternalTask -&gt; Const (Maybe (Path Rel File)) ExternalTask)
-&gt; ((Maybe (Path Rel File)
     -&gt; Const (Maybe (Path Rel File)) (Maybe (Path Rel File)))
    -&gt; OutputCapture -&gt; Const (Maybe (Path Rel File)) OutputCapture)
-&gt; (Maybe (Path Rel File)
    -&gt; Const (Maybe (Path Rel File)) (Maybe (Path Rel File)))
-&gt; ExternalTask
-&gt; Const (Maybe (Path Rel File)) ExternalTask
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OutputCapture -&gt; Maybe (Path Rel File))
-&gt; (Maybe (Path Rel File)
    -&gt; Const (Maybe (Path Rel File)) (Maybe (Path Rel File)))
-&gt; OutputCapture
-&gt; Const (Maybe (Path Rel File)) OutputCapture
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">OutputCapture -&gt; Maybe (Path Rel File)
</span><a href="Control.External.html#outputCaptureToRelFile"><span class="hs-identifier hs-var">outputCaptureToRelFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Path Rel File -&gt; IO ()) -&gt; IO ())
-&gt; (Path Rel File -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-150"></span><span>                    </span><span class="hs-glyph">\</span><span id="local-6989586621679342816"><span class="annot"><span class="annottext">file :: Path Rel File
</span><a href="#local-6989586621679342816"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path Abs File -&gt; Path Abs File -&gt; IO ()
forall (m :: * -&gt; *) b0 b1.
MonadIO m =&gt;
Path b0 File -&gt; Path b1 File -&gt; m ()
</span><a href="../file:///nix/store/29hxzlip96mlvhzzln0baiws85977sln-path-io-lib-path-io-1.6.0-haddock-doc/share/doc/path-io/html/src"><span class="hs-identifier hs-var">copyFile</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs File
</span><a href="#local-6989586621679342904"><span class="hs-identifier hs-var">fpOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path Abs Dir
</span><a href="#local-6989586621679342905"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs Dir -&gt; Path Rel File -&gt; Path Abs File
forall b t. Path b Dir -&gt; Path Rel t -&gt; Path b t
</span><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Path Rel File
</span><a href="#local-6989586621679342816"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>                  </span><span class="annot"><span class="annottext">Either (TimeSpec, Int) TimeSpec
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (TimeSpec, Int) TimeSpec
 -&gt; IO (Either (TimeSpec, Int) TimeSpec))
-&gt; Either (TimeSpec, Int) TimeSpec
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; Either (TimeSpec, Int) TimeSpec
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; TimeSpec -&gt; TimeSpec
</span><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">diffTimeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342835"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342818"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">ExitFailure</span></span><span> </span><span id="local-6989586621679342811"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679342811"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>                  </span><span class="annot"><span class="annottext">Either (TimeSpec, Int) TimeSpec
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (TimeSpec, Int) TimeSpec
 -&gt; IO (Either (TimeSpec, Int) TimeSpec))
-&gt; Either (TimeSpec, Int) TimeSpec
-&gt; IO (Either (TimeSpec, Int) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TimeSpec, Int) -&gt; Either (TimeSpec, Int) TimeSpec
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; TimeSpec -&gt; TimeSpec
</span><a href="../file:///nix/store/yqkvyxl0pdjqgj46vhbmlybp9lp8dnsw-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">diffTimeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342835"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342818"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342811"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException (Either (TimeSpec, Int) TimeSpec)
</span><a href="#local-6989586621679342824"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-comment">-- execution was successful</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679342810"><span class="annot"><span class="annottext">r :: TimeSpec
</span><a href="#local-6989586621679342810"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Either IOException (TimeSpec, Int)) TimeSpec
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Either IOException (TimeSpec, Int)) TimeSpec
 -&gt; KatipContextT
      IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; Either (Either IOException (TimeSpec, Int)) TimeSpec
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; Either (Either IOException (TimeSpec, Int)) TimeSpec
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342810"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-comment">-- execution failed</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679342809"><span class="annot"><span class="annottext">e :: (TimeSpec, Int)
</span><a href="#local-6989586621679342809"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Either IOException (TimeSpec, Int)) TimeSpec
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Either IOException (TimeSpec, Int)) TimeSpec
 -&gt; KatipContextT
      IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; Either (Either IOException (TimeSpec, Int)) TimeSpec
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either IOException (TimeSpec, Int)
-&gt; Either (Either IOException (TimeSpec, Int)) TimeSpec
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TimeSpec, Int) -&gt; Either IOException (TimeSpec, Int)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(TimeSpec, Int)
</span><a href="#local-6989586621679342809"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-comment">-- executor itself failed</span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679342808"><span class="annot"><span class="annottext">e :: IOException
</span><a href="#local-6989586621679342808"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (Either IOException (TimeSpec, Int)) TimeSpec
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either (Either IOException (TimeSpec, Int)) TimeSpec
 -&gt; KatipContextT
      IO (Either (Either IOException (TimeSpec, Int)) TimeSpec))
-&gt; Either (Either IOException (TimeSpec, Int)) TimeSpec
-&gt; KatipContextT
     IO (Either (Either IOException (TimeSpec, Int)) TimeSpec)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either IOException (TimeSpec, Int)
-&gt; Either (Either IOException (TimeSpec, Int)) TimeSpec
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; Either IOException (TimeSpec, Int)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679342808"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
  (Either IOException (TimeSpec, Int)) () (Maybe TimeSpec, Item)
</span><a href="#local-6989586621679342910"><span class="hs-identifier hs-var">status</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679342806"><span class="annot"><span class="annottext">e :: IOException
</span><a href="#local-6989586621679342806"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecutionResult -&gt; KatipContextT IO ExecutionResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; ExecutionResult
</span><a href="Control.External.Executor.html#ExecutorFailure"><span class="hs-identifier hs-var">ExecutorFailure</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679342806"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679342805"><span class="annot"><span class="annottext">t :: TimeSpec
</span><a href="#local-6989586621679342805"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679342804"><span class="annot"><span class="annottext">ec :: Int
</span><a href="#local-6989586621679342804"><span class="hs-identifier hs-var">ec</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecutionResult -&gt; KatipContextT IO ExecutionResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; Int -&gt; ExecutionResult
</span><a href="Control.External.Executor.html#Failure"><span class="hs-identifier hs-var">Failure</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342805"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342804"><span class="hs-identifier hs-var">ec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.Pending</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecutionResult -&gt; KatipContextT IO ExecutionResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ExecutionResult
</span><a href="Control.External.Executor.html#AlreadyRunning"><span class="hs-identifier hs-var">AlreadyRunning</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.Complete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecutionResult -&gt; KatipContextT IO ExecutionResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ExecutionResult
</span><a href="Control.External.Executor.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.Complete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679342801"><span class="annot"><span class="annottext">t :: TimeSpec
</span><a href="#local-6989586621679342801"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExecutionResult -&gt; KatipContextT IO ExecutionResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; ExecutionResult
</span><a href="Control.External.Executor.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342801"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679342911"><span class="annot"><span class="annottext">logError :: KatipContextT IO a -&gt; KatipContextT IO a
</span><a href="#local-6989586621679342911"><span class="hs-identifier hs-var hs-var">logError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KatipContextT IO a
 -&gt; (SomeException -&gt; KatipContextT IO ()) -&gt; KatipContextT IO a)
-&gt; (SomeException -&gt; KatipContextT IO ())
-&gt; KatipContextT IO a
-&gt; KatipContextT IO a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">KatipContextT IO a
-&gt; (SomeException -&gt; KatipContextT IO ()) -&gt; KatipContextT IO a
forall (m :: * -&gt; *) e a b.
(MonadMask m, Exception e) =&gt;
m a -&gt; (e -&gt; m b) -&gt; m a
</span><a href="../file:///nix/store/klpzhh530yhcxi2n0gkxsd4vh5zs5z8s-safe-exceptions-lib-safe-exceptions-0.1.7.1-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">withException</span></a></span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; KatipContextT IO ())
 -&gt; KatipContextT IO a -&gt; KatipContextT IO a)
-&gt; (SomeException -&gt; KatipContextT IO ())
-&gt; KatipContextT IO a
-&gt; KatipContextT IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679342798"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679342798"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(LogStr -&gt; KatipContextT IO ())
-&gt; (FilePath -&gt; LogStr) -&gt; FilePath -&gt; KatipContextT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; LogStr
forall a. StringConv a Text =&gt; a -&gt; LogStr
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; KatipContextT IO ())
-&gt; FilePath -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; FilePath
forall e. Exception e =&gt; e -&gt; FilePath
</span><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679342798"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- | Execute tasks forever</span><span>
</span><span id="line-172"></span><span class="annot"><a href="Control.External.Executor.html#executeLoop"><span class="hs-identifier hs-type">executeLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679342793"><span class="annot"><a href="#local-6989586621679342793"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><a href="Control.External.Coordinator.html#Coordinator"><span class="hs-identifier hs-type">Coordinator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679342793"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="#local-6989586621679342793"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="Control.External.Coordinator.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679342793"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.ContentStore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="executeLoop"><span class="annot"><span class="annottext">executeLoop :: c -&gt; Config c -&gt; ContentStore -&gt; IO ()
</span><a href="Control.External.Executor.html#executeLoop"><span class="hs-identifier hs-var hs-var">executeLoop</span></a></span></span><span> </span><span id="local-6989586621679342792"><span class="annot"><span class="annottext">coord :: c
</span><a href="#local-6989586621679342792"><span class="hs-identifier hs-var">coord</span></a></span></span><span> </span><span id="local-6989586621679342791"><span class="annot"><span class="annottext">cfg :: Config c
</span><a href="#local-6989586621679342791"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621679342790"><span class="annot"><span class="annottext">store :: ContentStore
</span><a href="#local-6989586621679342790"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="annottext">c -&gt; Config c -&gt; ContentStore -&gt; Scribe -&gt; IO ()
forall c.
Coordinator c =&gt;
c -&gt; Config c -&gt; ContentStore -&gt; Scribe -&gt; IO ()
</span><a href="Control.External.Executor.html#executeLoopWithScribe"><span class="hs-identifier hs-var">executeLoopWithScribe</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679342792"><span class="hs-identifier hs-var">coord</span></a></span><span> </span><span class="annot"><span class="annottext">Config c
</span><a href="#local-6989586621679342791"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342790"><span class="hs-identifier hs-var">store</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">(Scribe -&gt; IO ()) -&gt; IO Scribe -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ColorStrategy -&gt; Handle -&gt; PermitFunc -&gt; Verbosity -&gt; IO Scribe
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">mkHandleScribe</span></a></span><span> </span><span class="annot"><span class="annottext">ColorStrategy
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ColorIfTerminal</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stdout</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Severity -&gt; Item a -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; Severity -&gt; Item a -&gt; m Bool
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">permitItem</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">InfoS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">V2</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Same as 'executeLoop', but allows specifying a custom 'Scribe' for logging</span><span>
</span><span id="line-184"></span><span class="annot"><a href="Control.External.Executor.html#executeLoopWithScribe"><span class="hs-identifier hs-type">executeLoopWithScribe</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679342988"><span class="annot"><a href="#local-6989586621679342988"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Control.External.Coordinator.html#Coordinator"><span class="hs-identifier hs-type">Coordinator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679342988"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="#local-6989586621679342988"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="Control.External.Coordinator.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679342988"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.ContentStore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-type">Scribe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span id="executeLoopWithScribe"><span class="annot"><span class="annottext">executeLoopWithScribe :: c -&gt; Config c -&gt; ContentStore -&gt; Scribe -&gt; IO ()
</span><a href="Control.External.Executor.html#executeLoopWithScribe"><span class="hs-identifier hs-var hs-var">executeLoopWithScribe</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679342783"><span class="annot"><span class="annottext">cfg :: Config c
</span><a href="#local-6989586621679342783"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621679342782"><span class="annot"><span class="annottext">store :: ContentStore
</span><a href="#local-6989586621679342782"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679342781"><span class="annot"><span class="annottext">handleScribe :: Scribe
</span><a href="#local-6989586621679342781"><span class="hs-identifier hs-var">handleScribe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679342780"><span class="annot"><span class="annottext">mkLogEnv :: IO LogEnv
</span><a href="#local-6989586621679342780"><span class="hs-identifier hs-var hs-var">mkLogEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Scribe -&gt; ScribeSettings -&gt; LogEnv -&gt; IO LogEnv
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">registerScribe</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;stdout&quot;</span></span><span> </span><span class="annot"><span class="annottext">Scribe
</span><a href="#local-6989586621679342781"><span class="hs-identifier hs-var">handleScribe</span></a></span><span> </span><span class="annot"><span class="annottext">ScribeSettings
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">defaultScribeSettings</span></a></span><span> </span><span class="annot"><span class="annottext">(LogEnv -&gt; IO LogEnv) -&gt; IO LogEnv -&gt; IO LogEnv
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Namespace -&gt; Environment -&gt; IO LogEnv
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">initLogEnv</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;FFExecutorD&quot;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;production&quot;</span></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><span class="annottext">IO LogEnv -&gt; (LogEnv -&gt; IO LogEnv) -&gt; (LogEnv -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b c.
MonadMask m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="../file:///nix/store/klpzhh530yhcxi2n0gkxsd4vh5zs5z8s-safe-exceptions-lib-safe-exceptions-0.1.7.1-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">bracket</span></a></span><span> </span><span class="annot"><span class="annottext">IO LogEnv
</span><a href="#local-6989586621679342780"><span class="hs-identifier hs-var">mkLogEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LogEnv -&gt; IO LogEnv
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">closeScribes</span></a></span><span> </span><span class="annot"><span class="annottext">((LogEnv -&gt; IO ()) -&gt; IO ()) -&gt; (LogEnv -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679342774"><span class="annot"><span class="annottext">le :: LogEnv
</span><a href="#local-6989586621679342774"><span class="hs-identifier hs-var">le</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679342773"><span class="annot"><span class="annottext">initialContext :: ()
</span><a href="#local-6989586621679342773"><span class="hs-identifier hs-var hs-var">initialContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span id="local-6989586621679342772"><span class="annot"><span class="annottext">initialNamespace :: Namespace
</span><a href="#local-6989586621679342772"><span class="hs-identifier hs-var hs-var">initialNamespace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;executeLoop&quot;</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">LogEnv -&gt; () -&gt; Namespace -&gt; KatipContextT IO () -&gt; IO ()
forall c (m :: * -&gt; *) a.
LogItem c =&gt;
LogEnv -&gt; c -&gt; Namespace -&gt; KatipContextT m a -&gt; m a
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">runKatipContextT</span></a></span><span> </span><span class="annot"><span class="annottext">LogEnv
</span><a href="#local-6989586621679342774"><span class="hs-identifier hs-var">le</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621679342773"><span class="hs-identifier hs-var">initialContext</span></a></span><span> </span><span class="annot"><span class="annottext">Namespace
</span><a href="#local-6989586621679342772"><span class="hs-identifier hs-var">initialNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">(KatipContextT IO () -&gt; IO ()) -&gt; KatipContextT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">InfoS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Initialising connection to coordinator.&quot;</span></span><span>
</span><span id="line-199"></span><span>      </span><span id="local-6989586621679342770"><span class="annot"><a href="#local-6989586621679342770"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.External.Coordinator.html#Hook"><span class="hs-identifier hs-type">Hook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679342988"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Hook c) -&gt; KatipContextT IO (Hook c)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO (Hook c) -&gt; KatipContextT IO (Hook c))
-&gt; IO (Hook c) -&gt; KatipContextT IO (Hook c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Config c -&gt; IO (Hook c)
forall c (m :: * -&gt; *).
(Coordinator c, MonadIO m) =&gt;
Config c -&gt; m (Hook c)
</span><a href="Control.External.Coordinator.html#initialise"><span class="hs-identifier hs-var">initialise</span></a></span><span> </span><span class="annot"><span class="annottext">Config c
</span><a href="#local-6989586621679342783"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span id="local-6989586621679342768"><span class="annot"><span class="annottext">Executor
</span><a href="#local-6989586621679342768"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Executor -&gt; KatipContextT IO Executor
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO Executor -&gt; KatipContextT IO Executor)
-&gt; IO Executor -&gt; KatipContextT IO Executor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Executor
</span><a href="Control.External.Coordinator.html#Executor"><span class="hs-identifier hs-var">Executor</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Executor) -&gt; IO FilePath -&gt; IO Executor
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><a href="../file:///nix/store/z6i98d27j4l05nfcjlmrk1yabp9rhqcl-hostname-lib-hostname-1.0-haddock-doc/share/doc/hostname/html/src"><span class="hs-identifier hs-var">getHostName</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Known failures that do not affect the executors ability</span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-comment">-- to execute further tasks will be logged and ignored.</span><span>
</span><span id="line-203"></span><span>          </span><span id="local-6989586621679342765"><span class="annot"><span class="annottext">handleFailures :: KatipContextT IO () -&gt; KatipContextT IO ()
</span><a href="#local-6989586621679342765"><span class="hs-identifier hs-var hs-var">handleFailures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StoreError -&gt; KatipContextT IO ())
-&gt; KatipContextT IO () -&gt; KatipContextT IO ()
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../file:///nix/store/klpzhh530yhcxi2n0gkxsd4vh5zs5z8s-safe-exceptions-lib-safe-exceptions-0.1.7.1-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">((StoreError -&gt; KatipContextT IO ())
 -&gt; KatipContextT IO () -&gt; KatipContextT IO ())
-&gt; (StoreError -&gt; KatipContextT IO ())
-&gt; KatipContextT IO ()
-&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679342763"><span class="annot"><span class="annottext">StoreError
</span><a href="#local-6989586621679342763"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">CS.StoreError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-comment">-- Certain store errors can occur if an item is forcibly removed</span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-comment">-- while the executor is constructing it or picked up a</span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-comment">-- corresponding outdated task from the queue.</span><span>
</span><span id="line-207"></span><span>            </span><span class="hs-comment">-- XXX: The store should distinguish between recoverable</span><span>
</span><span id="line-208"></span><span>            </span><span class="hs-comment">--   and unrecoverable errors.</span><span>
</span><span id="line-209"></span><span>            </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">WarningS</span></a></span><span> </span><span class="annot"><span class="annottext">(LogStr -&gt; KatipContextT IO ())
-&gt; (FilePath -&gt; LogStr) -&gt; FilePath -&gt; KatipContextT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; LogStr
forall a. StringConv a Text =&gt; a -&gt; LogStr
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; KatipContextT IO ())
-&gt; FilePath -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StoreError -&gt; FilePath
forall e. Exception e =&gt; e -&gt; FilePath
</span><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="annot"><span class="annottext">StoreError
</span><a href="#local-6989586621679342763"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="annot"><span class="annottext">KatipContextT IO () -&gt; KatipContextT IO ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">(KatipContextT IO () -&gt; KatipContextT IO ())
-&gt; KatipContextT IO () -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="annottext">KatipContextT IO () -&gt; KatipContextT IO ()
</span><a href="#local-6989586621679342765"><span class="hs-identifier hs-var">handleFailures</span></a></span><span> </span><span class="annot"><span class="annottext">(KatipContextT IO () -&gt; KatipContextT IO ())
-&gt; KatipContextT IO () -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">DebugS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Awaiting task from coordinator.&quot;</span></span><span>
</span><span id="line-213"></span><span>          </span><span id="local-6989586621679342760"><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679342760"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hook c
-&gt; Executor
-&gt; (TaskDescription -&gt; KatipContextT IO (TimeSpec, Either Int ()))
-&gt; KatipContextT IO (Maybe ())
forall c (m :: * -&gt; *).
(Coordinator c, MonadIO m, MonadMask m, KatipContext m) =&gt;
Hook c
-&gt; Executor
-&gt; (TaskDescription -&gt; m (TimeSpec, Either Int ()))
-&gt; m (Maybe ())
</span><a href="Control.External.Coordinator.html#withPopTask"><span class="hs-identifier hs-var">withPopTask</span></a></span><span> </span><span class="annot"><span class="annottext">Hook c
</span><a href="#local-6989586621679342770"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">Executor
</span><a href="#local-6989586621679342768"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">((TaskDescription -&gt; KatipContextT IO (TimeSpec, Either Int ()))
 -&gt; KatipContextT IO (Maybe ()))
-&gt; (TaskDescription -&gt; KatipContextT IO (TimeSpec, Either Int ()))
-&gt; KatipContextT IO (Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679342758"><span class="annot"><span class="annottext">task :: TaskDescription
</span><a href="#local-6989586621679342758"><span class="hs-identifier hs-var">task</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>            </span><span class="annot"><span class="annottext">SimpleLogPayload
-&gt; KatipContextT IO (TimeSpec, Either Int ())
-&gt; KatipContextT IO (TimeSpec, Either Int ())
forall i (m :: * -&gt; *) a.
(LogItem i, KatipContext m) =&gt;
i -&gt; m a -&gt; m a
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">katipAddContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; SimpleLogPayload
forall a. ToJSON a =&gt; Text -&gt; a -&gt; SimpleLogPayload
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;task&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ContentHash -&gt; SimpleLogPayload)
-&gt; ContentHash -&gt; SimpleLogPayload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342758"><span class="hs-identifier hs-var">task</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KatipContextT IO (TimeSpec, Either Int ())
 -&gt; KatipContextT IO (TimeSpec, Either Int ()))
-&gt; KatipContextT IO (TimeSpec, Either Int ())
-&gt; KatipContextT IO (TimeSpec, Either Int ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>              </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">DebugS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Checking task&quot;</span></span><span>
</span><span id="line-216"></span><span>              </span><span id="local-6989586621679342757"><span class="annot"><span class="annottext">ExecutionResult
</span><a href="#local-6989586621679342757"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentStore -&gt; TaskDescription -&gt; KatipContextT IO ExecutionResult
</span><a href="Control.External.Executor.html#execute"><span class="hs-identifier hs-var">execute</span></a></span><span> </span><span class="annot"><span class="annottext">ContentStore
</span><a href="#local-6989586621679342782"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342758"><span class="hs-identifier hs-var">task</span></a></span><span>
</span><span id="line-217"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExecutionResult
</span><a href="#local-6989586621679342757"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>                </span><span class="annot"><a href="Control.External.Executor.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>                  </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">InfoS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Task was cached&quot;</span></span><span>
</span><span id="line-220"></span><span>                  </span><span class="annot"><span class="annottext">(TimeSpec, Either Int ())
-&gt; KatipContextT IO (TimeSpec, Either Int ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either Int ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>                </span><span class="annot"><a href="Control.External.Executor.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679342756"><span class="annot"><span class="annottext">t :: TimeSpec
</span><a href="#local-6989586621679342756"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>                  </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">InfoS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Task completed successfully&quot;</span></span><span>
</span><span id="line-223"></span><span>                  </span><span class="annot"><span class="annottext">(TimeSpec, Either Int ())
-&gt; KatipContextT IO (TimeSpec, Either Int ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342756"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either Int ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>                </span><span class="annot"><a href="Control.External.Executor.html#Failure"><span class="hs-identifier hs-type">Failure</span></a></span><span> </span><span id="local-6989586621679342755"><span class="annot"><span class="annottext">t :: TimeSpec
</span><a href="#local-6989586621679342755"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679342754"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679342754"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>                  </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">WarningS</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Task failed&quot;</span></span><span>
</span><span id="line-226"></span><span>                  </span><span class="annot"><span class="annottext">(TimeSpec, Either Int ())
-&gt; KatipContextT IO (TimeSpec, Either Int ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679342755"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Either Int ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342754"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>                </span><span class="annot"><a href="Control.External.Executor.html#ExecutorFailure"><span class="hs-identifier hs-type">ExecutorFailure</span></a></span><span> </span><span id="local-6989586621679342753"><span class="annot"><span class="annottext">e :: IOException
</span><a href="#local-6989586621679342753"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>                  </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(LogStr -&gt; KatipContextT IO ()) -&gt; LogStr -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Executor failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">LogStr -&gt; LogStr -&gt; LogStr
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; LogStr
forall a. StringConv a Text =&gt; a -&gt; LogStr
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; FilePath
forall e. Exception e =&gt; e -&gt; FilePath
</span><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679342753"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>                  </span><span class="annot"><span class="annottext">(TimeSpec, Either Int ())
-&gt; KatipContextT IO (TimeSpec, Either Int ())
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Either Int ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>                </span><span class="annot"><a href="Control.External.Executor.html#AlreadyRunning"><span class="hs-identifier hs-type">AlreadyRunning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>                  </span><span class="hs-comment">-- XXX:</span><span>
</span><span id="line-232"></span><span>                  </span><span class="hs-comment">--   This should not happen and indicates a programming error</span><span>
</span><span id="line-233"></span><span>                  </span><span class="hs-comment">--   or invalid state.</span><span>
</span><span id="line-234"></span><span>                  </span><span class="hs-comment">--   We do not want to just put the task back on the queue,</span><span>
</span><span id="line-235"></span><span>                  </span><span class="hs-comment">--   as it would cause a loop.</span><span>
</span><span id="line-236"></span><span>                  </span><span class="hs-comment">--   We do not want to just mark the task done, as a potential</span><span>
</span><span id="line-237"></span><span>                  </span><span class="hs-comment">--   later completion of the already running external task</span><span>
</span><span id="line-238"></span><span>                  </span><span class="hs-comment">--   would to mark it as done then.</span><span>
</span><span id="line-239"></span><span>                  </span><span class="hs-comment">--   We cannot mark it as ongoing, as we don't have information</span><span>
</span><span id="line-240"></span><span>                  </span><span class="hs-comment">--   on the executor where the task is already running.</span><span>
</span><span id="line-241"></span><span>                  </span><span class="hs-special">$(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath -&gt; CharPos -&gt; CharPos -&gt; Loc
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; KatipContextT IO ()
Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *).
(Applicative m, KatipContext m, HasCallStack) =&gt;
Maybe Loc -&gt; Severity -&gt; LogStr -&gt; m ()
</span><span class="hs-identifier hs-var hs-var hs-var">logTM</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">ErrorS</span></a></span><span> </span><span class="annot"><span class="annottext">(LogStr -&gt; KatipContextT IO ()) -&gt; LogStr -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-242"></span><span>                    </span><span class="annot"><span class="hs-string">&quot;Received an already running task from the coordinator &quot;</span></span><span>
</span><span id="line-243"></span><span>                      </span><span class="annot"><span class="annottext">LogStr -&gt; LogStr -&gt; LogStr
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; LogStr
forall a. Show a =&gt; a -&gt; LogStr
</span><a href="../file:///nix/store/40p6ipjs8ci6bdgld4q9fy73iavg8f8m-katip-lib-katip-0.8.5.0-haddock-doc/share/doc/katip/html/src"><span class="hs-identifier hs-var">showLS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342758"><span class="hs-identifier hs-var">task</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>                  </span><span class="annot"><span class="annottext">FilePath -&gt; KatipContextT IO (TimeSpec, Either Int ())
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; KatipContextT IO (TimeSpec, Either Int ()))
-&gt; FilePath -&gt; KatipContextT IO (TimeSpec, Either Int ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-245"></span><span>                    </span><span class="annot"><span class="hs-string">&quot;Received an already running task from the coordinator &quot;</span></span><span>
</span><span id="line-246"></span><span>                      </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342758"><span class="hs-identifier hs-var">task</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/x0knwfajjpqaidfb3ssvd0q5z2nqvgx2-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679342760"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; KatipContextT IO ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; KatipContextT IO ()) -&gt; IO () -&gt; KatipContextT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="hs-number">1000000</span></span><span>
</span><span id="line-249"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; KatipContextT IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- | @withFollowFile in out@ follows the file @in@</span><span>
</span><span id="line-252"></span><span class="hs-comment">--   and prints contents to @out@ as they appear.</span><span>
</span><span id="line-253"></span><span class="hs-comment">--   The file must exist. Doesn't handle file truncation.</span><span>
</span><span id="line-254"></span><span id="local-6989586621679343096"><span class="annot"><a href="Control.External.Executor.html#withFollowFile"><span class="hs-identifier hs-type">withFollowFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-type">File</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679343096"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679343096"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-255"></span><span id="withFollowFile"><span class="annot"><span class="annottext">withFollowFile :: Path Abs File -&gt; Handle -&gt; IO a -&gt; IO a
</span><a href="Control.External.Executor.html#withFollowFile"><span class="hs-identifier hs-var hs-var">withFollowFile</span></a></span></span><span> </span><span id="local-6989586621679342750"><span class="annot"><span class="annottext">infile :: Path Abs File
</span><a href="#local-6989586621679342750"><span class="hs-identifier hs-var">infile</span></a></span></span><span> </span><span id="local-6989586621679342749"><span class="annot"><span class="annottext">outhandle :: Handle
</span><a href="#local-6989586621679342749"><span class="hs-identifier hs-var">outhandle</span></a></span></span><span> </span><span id="local-6989586621679342748"><span class="annot"><span class="annottext">action :: IO a
</span><a href="#local-6989586621679342748"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621679342747"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679342747"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621679342745"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342745"><span class="hs-identifier hs-var">inhandle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IOMode -&gt; IO Handle
</span><span class="hs-identifier hs-var">openFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path Abs File -&gt; FilePath
</span><a href="../file:///nix/store/l9kvx89p9jc4qplqjks0y1fnip27fdk5-path-lib-path-0.7.0-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-var">fromAbsFile</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs File
</span><a href="#local-6989586621679342750"><span class="hs-identifier hs-var">infile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadMode</span></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679342742"><span class="annot"><span class="annottext">loop :: IO ()
</span><a href="#local-6989586621679342742"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-259"></span><span>        </span><span id="local-6989586621679342741"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679342741"><span class="hs-identifier hs-var">some</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; Int -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BS.hGetSome</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342745"><span class="hs-identifier hs-var">inhandle</span></a></span><span> </span><span class="annot"><span class="hs-number">4096</span></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><span class="hs-identifier hs-var">BS.null</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679342741"><span class="hs-identifier hs-var">some</span></a></span><span>
</span><span id="line-261"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>            </span><span id="local-6989586621679342738"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679342738"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe () -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe () -&gt; Bool) -&gt; IO (Maybe ()) -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; IO (Maybe ())
forall a. MVar a -&gt; IO (Maybe a)
</span><span class="hs-identifier hs-var">tryTakeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679342747"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-263"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679342738"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="hs-number">10000</span></span><span>
</span><span id="line-265"></span><span>              </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679342742"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-266"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>            </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BS.hPut</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342749"><span class="hs-identifier hs-var">outhandle</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679342741"><span class="hs-identifier hs-var">some</span></a></span><span>
</span><span id="line-268"></span><span>            </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679342742"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621679342735"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679342735"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Either IOException (), a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Either IOException (), a) -&gt; a)
-&gt; IO (Either IOException (), a) -&gt; IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Either IOException ()) -&gt; IO a -&gt; IO (Either IOException (), a)
forall a b. IO a -&gt; IO b -&gt; IO (a, b)
</span><a href="../file:///nix/store/45zngjmlcb55hnlzbhhvjn307c9jrsn5-async-lib-async-2.2.2-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-var">concurrently</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO (Either IOException ())
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
m a -&gt; m (Either IOException a)
</span><a href="../file:///nix/store/klpzhh530yhcxi2n0gkxsd4vh5zs5z8s-safe-exceptions-lib-safe-exceptions-0.1.7.1-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679342742"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679342748"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621679342747"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>  </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679342745"><span class="hs-identifier hs-var">inhandle</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679342735"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-272"></span></pre></body></html>