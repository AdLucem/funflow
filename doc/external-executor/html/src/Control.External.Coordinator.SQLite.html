<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24maxtag_EUUQlVtXyxV1YYftTlJemJ"><span id="%24tag2con_EUUQlVtXyxV1YYftTlJemJ"><span id="%24con2tag_EUUQlVtXyxV1YYftTlJemJ"></span></span></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- | SQLLite co-ordinator for Funflow.</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">--   This co-ordinator effectively uses the shared filesystem as a tool for task</span><span>
</span><span id="line-10"></span><span class="hs-comment">--   distribution and sequencing. This means that it can control a distributed</span><span>
</span><span id="line-11"></span><span class="hs-comment">--   funflow task without needing any additional processes running.</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.External.Coordinator.SQLite</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLite"><span class="hs-identifier">SQLite</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/91yfmikxdcxwm4gzkl7lwamnf4wqc7z0-safe-exceptions-lib-safe-exceptions-0.1.7.0-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier">Control.Exception.Safe</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.External.html"><span class="hs-identifier">Control.External</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.External.Coordinator.html"><span class="hs-identifier">Control.External.Coordinator</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/dszanqdpjc85v1jyvmgqmn2cwfxd78ll-aeson-lib-aeson-1.4.7.1-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Json</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C8</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cas-hashable/html/src"><span class="hs-identifier">Data.CAS.ContentHashable</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier">Data.CAS.Lock</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SQL</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple.FromField</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SQL</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple.Ok</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SQL</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier">Database.SQLite.Simple.ToField</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SQL</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-identifier">Path</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/pjkyiyv14csrfr5mybf8nkdqvh6awafi-path-io-lib-path-io-1.6.0-haddock-doc/share/doc/path-io/html/src"><span class="hs-identifier">Path.IO</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/azryzd3vkyvpasnzcshrfkxs2m455rhz-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier">System.Clock</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | SQLite coordinator tag.</span><span>
</span><span id="line-37"></span><span class="hs-keyword">data</span><span> </span><span id="SQLite"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLite"><span class="hs-identifier hs-var">SQLite</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SQLite"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLite"><span class="hs-identifier hs-var">SQLite</span></a></span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- | SQLite coordinator hook.</span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="SQLiteHook"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteHook"><span class="hs-identifier hs-var">SQLiteHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SQLiteHook"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteHook"><span class="hs-identifier hs-var">SQLiteHook</span></a></span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_sqlConn"><span class="annot"><span class="annottext">SQLiteHook -&gt; Connection
</span><a href="Control.External.Coordinator.SQLite.html#_sqlConn"><span class="hs-identifier hs-var hs-var">_sqlConn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.Connection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span id="_sqlLock"><span class="annot"><span class="annottext">SQLiteHook -&gt; Lock
</span><a href="Control.External.Coordinator.SQLite.html#_sqlLock"><span class="hs-identifier hs-var hs-var">_sqlLock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-type">Lock</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span id="sqlLock"><span id="sqlConn"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SQLiteHook</span></span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- | Take the lock and run the given action on the SQLite connection.</span><span>
</span><span id="line-48"></span><span id="local-6989586621679342721"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-type">withSQLite</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteHook"><span class="hs-identifier hs-type">SQLiteHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679342721"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679342721"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-49"></span><span id="withSQLite"><span class="annot"><span class="annottext">withSQLite :: SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var hs-var">withSQLite</span></a></span></span><span> </span><span id="local-6989586621679342662"><span class="annot"><span class="annottext">hook :: SQLiteHook
</span><a href="#local-6989586621679342662"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342661"><span class="annot"><span class="annottext">action :: Connection -&gt; IO a
</span><a href="#local-6989586621679342661"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lock -&gt; IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; Lock -&gt; m a -&gt; m a
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">withLock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLiteHook
</span><a href="#local-6989586621679342662"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">SQLiteHook -&gt; Getting Lock SQLiteHook Lock -&gt; Lock
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Lock SQLiteHook Lock
Lens' SQLiteHook Lock
</span><a href="Control.External.Coordinator.SQLite.html#sqlLock"><span class="hs-identifier hs-var">sqlLock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO a
</span><a href="#local-6989586621679342661"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SQLiteHook
</span><a href="#local-6989586621679342662"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">SQLiteHook
-&gt; Getting Connection SQLiteHook Connection -&gt; Connection
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Connection SQLiteHook Connection
Lens' SQLiteHook Connection
</span><a href="Control.External.Coordinator.SQLite.html#sqlConn"><span class="hs-identifier hs-var">sqlConn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Enumeration of possible 'TaskStatus' cases for SQLite status column.</span><span>
</span><span id="line-52"></span><span class="hs-keyword">data</span><span> </span><span id="SqlTaskStatus"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskStatus"><span class="hs-identifier hs-var">SqlTaskStatus</span></a></span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SqlPending"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-var">SqlPending</span></a></span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SqlRunning"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlRunning"><span class="hs-identifier hs-var">SqlRunning</span></a></span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SqlCompleted"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlCompleted"><span class="hs-identifier hs-var">SqlCompleted</span></a></span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SqlFailed"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlFailed"><span class="hs-identifier hs-var">SqlFailed</span></a></span></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679342639"><span id="local-6989586621679342641"><span id="local-6989586621679342643"><span id="local-6989586621679342645"><span id="local-6989586621679342647"><span id="local-6989586621679342649"><span id="local-6989586621679342651"><span id="local-6989586621679342653"><span class="annot"><span class="annottext">Int -&gt; SqlTaskStatus
SqlTaskStatus -&gt; Int
SqlTaskStatus -&gt; [SqlTaskStatus]
SqlTaskStatus -&gt; SqlTaskStatus
SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
SqlTaskStatus -&gt; SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
(SqlTaskStatus -&gt; SqlTaskStatus)
-&gt; (SqlTaskStatus -&gt; SqlTaskStatus)
-&gt; (Int -&gt; SqlTaskStatus)
-&gt; (SqlTaskStatus -&gt; Int)
-&gt; (SqlTaskStatus -&gt; [SqlTaskStatus])
-&gt; (SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus])
-&gt; (SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus])
-&gt; (SqlTaskStatus
    -&gt; SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus])
-&gt; Enum SqlTaskStatus
forall a.
(a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Int -&gt; a)
-&gt; (a -&gt; Int)
-&gt; (a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; [a])
-&gt; (a -&gt; a -&gt; a -&gt; [a])
-&gt; Enum a
enumFromThenTo :: SqlTaskStatus -&gt; SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
$cenumFromThenTo :: SqlTaskStatus -&gt; SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
enumFromTo :: SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
$cenumFromTo :: SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
enumFromThen :: SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
$cenumFromThen :: SqlTaskStatus -&gt; SqlTaskStatus -&gt; [SqlTaskStatus]
enumFrom :: SqlTaskStatus -&gt; [SqlTaskStatus]
$cenumFrom :: SqlTaskStatus -&gt; [SqlTaskStatus]
fromEnum :: SqlTaskStatus -&gt; Int
$cfromEnum :: SqlTaskStatus -&gt; Int
toEnum :: Int -&gt; SqlTaskStatus
$ctoEnum :: Int -&gt; SqlTaskStatus
pred :: SqlTaskStatus -&gt; SqlTaskStatus
$cpred :: SqlTaskStatus -&gt; SqlTaskStatus
succ :: SqlTaskStatus -&gt; SqlTaskStatus
$csucc :: SqlTaskStatus -&gt; SqlTaskStatus
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Enum</span></span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.FromField</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskStatus"><span class="hs-identifier hs-type">SqlTaskStatus</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621679342635"><span class="annot"><span class="annottext">fromField :: FieldParser SqlTaskStatus
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromField</span></a></span></span><span> </span><span id="local-6989586621679342633"><span class="annot"><span class="annottext">field :: Field
</span><a href="#local-6989586621679342633"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621679342632"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342632"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldParser Int
forall a. FromField a =&gt; FieldParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.fromField</span></a></span><span> </span><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679342633"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="annottext">SqlTaskStatus -&gt; Ok SqlTaskStatus
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SqlTaskStatus -&gt; Ok SqlTaskStatus)
-&gt; SqlTaskStatus -&gt; Ok SqlTaskStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SqlTaskStatus
forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342632"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.ToField</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskStatus"><span class="hs-identifier hs-type">SqlTaskStatus</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679342627"><span class="annot"><span class="annottext">toField :: SqlTaskStatus -&gt; SQLData
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.toField</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SQLData)
-&gt; (SqlTaskStatus -&gt; Int) -&gt; SqlTaskStatus -&gt; SQLData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- | Wrapper around 'Executor' for SQLite serialization.</span><span>
</span><span id="line-68"></span><span class="hs-keyword">newtype</span><span> </span><span id="SqlExecutor"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-var">SqlExecutor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SqlExecutor"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-var">SqlExecutor</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getSqlExecutor"><span class="annot"><span class="annottext">SqlExecutor -&gt; Executor
</span><a href="Control.External.Coordinator.SQLite.html#getSqlExecutor"><span class="hs-identifier hs-var hs-var">getSqlExecutor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.External.Coordinator.html#Executor"><span class="hs-identifier hs-type">Executor</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.FromField</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-type">SqlExecutor</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679342620"><span class="annot"><span class="annottext">fromField :: FieldParser SqlExecutor
</span><a href="#local-6989586621679342620"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromField</span></a></span></span><span> </span><span id="local-6989586621679342619"><span class="annot"><span class="annottext">field :: Field
</span><a href="#local-6989586621679342619"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Executor -&gt; SqlExecutor
</span><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-var">SqlExecutor</span></a></span><span> </span><span class="annot"><span class="annottext">(Executor -&gt; SqlExecutor)
-&gt; (HostName -&gt; Executor) -&gt; HostName -&gt; SqlExecutor
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HostName -&gt; Executor
</span><a href="Control.External.Coordinator.html#Executor"><span class="hs-identifier hs-var">Executor</span></a></span><span> </span><span class="annot"><span class="annottext">(HostName -&gt; SqlExecutor) -&gt; Ok HostName -&gt; Ok SqlExecutor
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldParser HostName
forall a. FromField a =&gt; FieldParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.fromField</span></a></span><span> </span><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679342619"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.ToField</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-type">SqlExecutor</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621679342615"><span class="annot"><span class="annottext">toField :: SqlExecutor -&gt; SQLData
</span><a href="#local-6989586621679342615"><span class="hs-identifier hs-var hs-var hs-var hs-var">toField</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-type">SqlExecutor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.html#Executor"><span class="hs-identifier hs-type">Executor</span></a></span><span> </span><span id="local-6989586621679342614"><span class="annot"><span class="annottext">host :: HostName
</span><a href="#local-6989586621679342614"><span class="hs-identifier hs-var">host</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HostName -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.toField</span></a></span><span> </span><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679342614"><span class="hs-identifier hs-var">host</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | SQLite task info query result.</span><span>
</span><span id="line-77"></span><span class="hs-keyword">data</span><span> </span><span id="SqlTaskInfo"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskInfo"><span class="hs-identifier hs-var">SqlTaskInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SqlTaskInfo"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskInfo"><span class="hs-identifier hs-var">SqlTaskInfo</span></a></span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_stiStatus"><span class="annot"><span class="annottext">SqlTaskInfo -&gt; SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#_stiStatus"><span class="hs-identifier hs-var hs-var">_stiStatus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskStatus"><span class="hs-identifier hs-type">SqlTaskStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span id="_stiExecutor"><span class="annot"><span class="annottext">SqlTaskInfo -&gt; Maybe SqlExecutor
</span><a href="Control.External.Coordinator.SQLite.html#_stiExecutor"><span class="hs-identifier hs-var hs-var">_stiExecutor</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-type">SqlExecutor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span id="_stiElapsed"><span class="annot"><span class="annottext">SqlTaskInfo -&gt; Maybe Integer
</span><a href="Control.External.Coordinator.SQLite.html#_stiElapsed"><span class="hs-identifier hs-var hs-var">_stiElapsed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span id="_stiExitCode"><span class="annot"><span class="annottext">SqlTaskInfo -&gt; Maybe Int
</span><a href="Control.External.Coordinator.SQLite.html#_stiExitCode"><span class="hs-identifier hs-var hs-var">_stiExitCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="stiStatus"><span id="stiExitCode"><span id="stiExecutor"><span id="stiElapsed"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SqlTaskInfo</span></span></span></span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.FromRow</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTaskInfo"><span class="hs-identifier hs-type">SqlTaskInfo</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>  </span><span id="local-6989586621679342602"><span class="annot"><span class="annottext">fromRow :: RowParser SqlTaskInfo
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">SqlTaskStatus
-&gt; Maybe SqlExecutor -&gt; Maybe Integer -&gt; Maybe Int -&gt; SqlTaskInfo
</span><a href="Control.External.Coordinator.SQLite.html#SqlTaskInfo"><span class="hs-identifier hs-var">SqlTaskInfo</span></a></span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">(SqlTaskStatus
 -&gt; Maybe SqlExecutor -&gt; Maybe Integer -&gt; Maybe Int -&gt; SqlTaskInfo)
-&gt; RowParser SqlTaskStatus
-&gt; RowParser
     (Maybe SqlExecutor -&gt; Maybe Integer -&gt; Maybe Int -&gt; SqlTaskInfo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">RowParser SqlTaskStatus
forall a. FromField a =&gt; RowParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.field</span></a></span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="annottext">RowParser
  (Maybe SqlExecutor -&gt; Maybe Integer -&gt; Maybe Int -&gt; SqlTaskInfo)
-&gt; RowParser (Maybe SqlExecutor)
-&gt; RowParser (Maybe Integer -&gt; Maybe Int -&gt; SqlTaskInfo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe SqlExecutor)
forall a. FromField a =&gt; RowParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.field</span></a></span><span>
</span><span id="line-91"></span><span>      </span><span class="annot"><span class="annottext">RowParser (Maybe Integer -&gt; Maybe Int -&gt; SqlTaskInfo)
-&gt; RowParser (Maybe Integer)
-&gt; RowParser (Maybe Int -&gt; SqlTaskInfo)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe Integer)
forall a. FromField a =&gt; RowParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.field</span></a></span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><span class="annottext">RowParser (Maybe Int -&gt; SqlTaskInfo)
-&gt; RowParser (Maybe Int) -&gt; RowParser SqlTaskInfo
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">RowParser (Maybe Int)
forall a. FromField a =&gt; RowParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.field</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Wrapper around 'ExternalTask' for SQLite serialization.</span><span>
</span><span id="line-95"></span><span class="hs-keyword">newtype</span><span> </span><span id="SqlExternal"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-var">SqlExternal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SqlExternal"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-var">SqlExternal</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getSqlExternal"><span class="annot"><span class="annottext">SqlExternal -&gt; ExternalTask
</span><a href="Control.External.Coordinator.SQLite.html#getSqlExternal"><span class="hs-identifier hs-var hs-var">getSqlExternal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.External.html#ExternalTask"><span class="hs-identifier hs-type">ExternalTask</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.FromField</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-type">SqlExternal</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>  </span><span id="local-6989586621679342596"><span class="annot"><span class="annottext">fromField :: FieldParser SqlExternal
</span><a href="#local-6989586621679342596"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromField</span></a></span></span><span> </span><span id="local-6989586621679342595"><span class="annot"><span class="annottext">field :: Field
</span><a href="#local-6989586621679342595"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679342594"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679342594"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldParser ByteString
forall a. FromField a =&gt; FieldParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.fromField</span></a></span><span> </span><span class="annot"><span class="annottext">Field
</span><a href="#local-6989586621679342595"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either HostName ExternalTask
forall a. FromJSON a =&gt; ByteString -&gt; Either HostName a
</span><a href="../file:///nix/store/dszanqdpjc85v1jyvmgqmn2cwfxd78ll-aeson-lib-aeson-1.4.7.1-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">Json.eitherDecode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679342594"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679342592"><span class="annot"><span class="annottext">err :: HostName
</span><a href="#local-6989586621679342592"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SomeException] -&gt; Ok SqlExternal
forall a. [SomeException] -&gt; Ok a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.Errors</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SQLiteCoordinatorError -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">(SQLiteCoordinatorError -&gt; SomeException)
-&gt; SQLiteCoordinatorError -&gt; SomeException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; HostName -&gt; SQLiteCoordinatorError
</span><a href="Control.External.Coordinator.SQLite.html#DecodingError"><span class="hs-identifier hs-var">DecodingError</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;task&quot;</span></span><span> </span><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679342592"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679342588"><span class="annot"><span class="annottext">x :: ExternalTask
</span><a href="#local-6989586621679342588"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SqlExternal -&gt; Ok SqlExternal
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SqlExternal -&gt; Ok SqlExternal) -&gt; SqlExternal -&gt; Ok SqlExternal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ExternalTask -&gt; SqlExternal
</span><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-var">SqlExternal</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalTask
</span><a href="#local-6989586621679342588"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.ToField</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-type">SqlExternal</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679342586"><span class="annot"><span class="annottext">toField :: SqlExternal -&gt; SQLData
</span><a href="#local-6989586621679342586"><span class="hs-identifier hs-var hs-var hs-var hs-var">toField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; SQLData
forall a. ToField a =&gt; a -&gt; SQLData
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.toField</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; SQLData)
-&gt; (SqlExternal -&gt; ByteString) -&gt; SqlExternal -&gt; SQLData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExternalTask -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../file:///nix/store/dszanqdpjc85v1jyvmgqmn2cwfxd78ll-aeson-lib-aeson-1.4.7.1-haddock-doc/share/doc/aeson/html/src"><span class="hs-identifier hs-var">Json.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(ExternalTask -&gt; ByteString)
-&gt; (SqlExternal -&gt; ExternalTask) -&gt; SqlExternal -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SqlExternal -&gt; ExternalTask
</span><a href="Control.External.Coordinator.SQLite.html#getSqlExternal"><span class="hs-identifier hs-var hs-var">getSqlExternal</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Wrapper around 'TaskDescription' for SQLite serialization.</span><span>
</span><span id="line-108"></span><span class="hs-keyword">newtype</span><span> </span><span id="SqlTask"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTask"><span class="hs-identifier hs-var">SqlTask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SqlTask"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTask"><span class="hs-identifier hs-var">SqlTask</span></a></span></span><span> </span><span class="annot"><a href="Control.External.html#TaskDescription"><span class="hs-identifier hs-type">TaskDescription</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-type">SQL.FromRow</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTask"><span class="hs-identifier hs-type">SqlTask</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621679342582"><span class="annot"><span class="annottext">fromRow :: RowParser SqlTask
</span><a href="#local-6989586621679342582"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromRow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679342581"><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342581"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RowParser ContentHash
forall a. FromField a =&gt; RowParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.field</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-type">SqlExternal</span></a></span><span> </span><span id="local-6989586621679342580"><span class="annot"><span class="annottext">task :: ExternalTask
</span><a href="#local-6989586621679342580"><span class="hs-identifier hs-var">task</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RowParser SqlExternal
forall a. FromField a =&gt; RowParser a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.field</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">SqlTask -&gt; RowParser SqlTask
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SqlTask -&gt; RowParser SqlTask) -&gt; SqlTask -&gt; RowParser SqlTask
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskDescription -&gt; SqlTask
</span><a href="Control.External.Coordinator.SQLite.html#SqlTask"><span class="hs-identifier hs-var">SqlTask</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="annottext">(TaskDescription -&gt; SqlTask) -&gt; TaskDescription -&gt; SqlTask
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskDescription :: ContentHash -&gt; ExternalTask -&gt; TaskDescription
</span><a href="Control.External.html#TaskDescription"><span class="hs-identifier hs-type hs-type">TaskDescription</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_tdOutput :: ContentHash
</span><a href="#local-6989586621679342577"><span class="hs-identifier hs-var">_tdOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342581"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">_tdTask :: ExternalTask
</span><a href="#local-6989586621679342576"><span class="hs-identifier hs-var">_tdTask</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalTask
</span><a href="#local-6989586621679342580"><span class="hs-identifier hs-var">task</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | Errors that can occur when interacting with the SQLite coordinator.</span><span>
</span><span id="line-121"></span><span class="hs-keyword">data</span><span> </span><span id="SQLiteCoordinatorError"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteCoordinatorError"><span class="hs-identifier hs-var">SQLiteCoordinatorError</span></a></span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | @MissingDBTaskEntry output field@</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">--   The task database entry is missing a field.</span><span>
</span><span id="line-124"></span><span>    </span><span id="MissingDBTaskEntry"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#MissingDBTaskEntry"><span class="hs-identifier hs-var">MissingDBTaskEntry</span></a></span></span><span> </span><span class="annot"><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-type">ContentHash</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | @DecodingError field error@</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">--   Failed to decode the field.</span><span>
</span><span id="line-127"></span><span>    </span><span id="DecodingError"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#DecodingError"><span class="hs-identifier hs-var">DecodingError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | @NonRunningTask output@</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">--   The task is not running.</span><span>
</span><span id="line-130"></span><span>    </span><span id="NonRunningTask"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#NonRunningTask"><span class="hs-identifier hs-var">NonRunningTask</span></a></span></span><span> </span><span class="annot"><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-type">ContentHash</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | @IllegalStatusUpdate output status@</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-comment">--   Cannot update the status of the task.</span><span>
</span><span id="line-133"></span><span>    </span><span id="IllegalStatusUpdate"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#IllegalStatusUpdate"><span class="hs-identifier hs-var">IllegalStatusUpdate</span></a></span></span><span> </span><span class="annot"><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-type">ContentHash</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.html#TaskStatus"><span class="hs-identifier hs-type">TaskStatus</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679342566"><span id="local-6989586621679342568"><span id="local-6989586621679342570"><span class="annot"><span class="annottext">Int -&gt; SQLiteCoordinatorError -&gt; ShowS
[SQLiteCoordinatorError] -&gt; ShowS
SQLiteCoordinatorError -&gt; HostName
(Int -&gt; SQLiteCoordinatorError -&gt; ShowS)
-&gt; (SQLiteCoordinatorError -&gt; HostName)
-&gt; ([SQLiteCoordinatorError] -&gt; ShowS)
-&gt; Show SQLiteCoordinatorError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; HostName) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SQLiteCoordinatorError] -&gt; ShowS
$cshowList :: [SQLiteCoordinatorError] -&gt; ShowS
show :: SQLiteCoordinatorError -&gt; HostName
$cshow :: SQLiteCoordinatorError -&gt; HostName
showsPrec :: Int -&gt; SQLiteCoordinatorError -&gt; ShowS
$cshowsPrec :: Int -&gt; SQLiteCoordinatorError -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679342559"><span id="local-6989586621679342561"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteCoordinatorError"><span class="hs-identifier hs-type">SQLiteCoordinatorError</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679342556"><span class="annot"><span class="annottext">displayException :: SQLiteCoordinatorError -&gt; HostName
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">displayException</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#MissingDBTaskEntry"><span class="hs-identifier hs-type">MissingDBTaskEntry</span></a></span><span> </span><span id="local-6989586621679342554"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342554"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679342553"><span class="annot"><span class="annottext">field :: Text
</span><a href="#local-6989586621679342553"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="hs-string">&quot;Missing field in SQLite task entry '&quot;</span></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; HostName
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679342553"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;' for output &quot;</span></span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HostName
</span><span class="hs-identifier hs-var">C8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContentHash -&gt; ByteString
</span><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-var">encodeHash</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342554"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#DecodingError"><span class="hs-identifier hs-type">DecodingError</span></a></span><span> </span><span id="local-6989586621679342549"><span class="annot"><span class="annottext">field :: Text
</span><a href="#local-6989586621679342549"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621679342548"><span class="annot"><span class="annottext">err :: HostName
</span><a href="#local-6989586621679342548"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-string">&quot;Failed to decode field '&quot;</span></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; HostName
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679342549"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;': &quot;</span></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HostName
</span><a href="#local-6989586621679342548"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#NonRunningTask"><span class="hs-identifier hs-type">NonRunningTask</span></a></span><span> </span><span id="local-6989586621679342547"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342547"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="hs-string">&quot;Task was not running when expected: &quot;</span></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HostName
</span><span class="hs-identifier hs-var">C8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContentHash -&gt; ByteString
</span><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-var">encodeHash</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342547"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#IllegalStatusUpdate"><span class="hs-identifier hs-type">IllegalStatusUpdate</span></a></span><span> </span><span id="local-6989586621679342546"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342546"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679342545"><span class="annot"><span class="annottext">status :: TaskStatus
</span><a href="#local-6989586621679342545"><span class="hs-identifier hs-var">status</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="hs-string">&quot;Illegal status update for &quot;</span></span><span>
</span><span id="line-152"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HostName
</span><span class="hs-identifier hs-var">C8.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContentHash -&gt; ByteString
</span><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-var">encodeHash</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342546"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">HostName -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TaskStatus -&gt; HostName
forall a. Show a =&gt; a -&gt; HostName
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TaskStatus
</span><a href="#local-6989586621679342545"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Helper for @NULL@ valued data-base fields.</span><span>
</span><span id="line-157"></span><span class="hs-comment">--</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- Throws 'MissingDBTaskEntry' on 'Nothing', otherwise returns the value.</span><span>
</span><span id="line-159"></span><span id="local-6989586621679342715"><span id="local-6989586621679342716"><span class="annot"><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-type">fromMaybeField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679342716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-type">ContentHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679342715"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679342716"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679342715"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-160"></span><span id="fromMaybeField"><span class="annot"><span class="annottext">fromMaybeField :: ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var hs-var">fromMaybeField</span></a></span></span><span> </span><span id="local-6989586621679342542"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342542"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679342541"><span class="annot"><span class="annottext">f :: Text
</span><a href="#local-6989586621679342541"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; m a) -&gt; IO a -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SQLiteCoordinatorError -&gt; IO a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/91yfmikxdcxwm4gzkl7lwamnf4wqc7z0-safe-exceptions-lib-safe-exceptions-0.1.7.0-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLiteCoordinatorError -&gt; IO a) -&gt; SQLiteCoordinatorError -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; SQLiteCoordinatorError
</span><a href="Control.External.Coordinator.SQLite.html#MissingDBTaskEntry"><span class="hs-identifier hs-var">MissingDBTaskEntry</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342542"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679342541"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679342538"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679342538"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679342538"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- | Unlifted version of 'taskInfo'.</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#taskInfo%27"><span class="hs-identifier hs-type">taskInfo'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteHook"><span class="hs-identifier hs-type">SQLiteHook</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cas-hashable/html/src"><span class="hs-identifier hs-type">ContentHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Control.External.Coordinator.html#TaskInfo"><span class="hs-identifier hs-type">TaskInfo</span></a></span><span>
</span><span id="line-166"></span><span id="taskInfo%27"><span class="annot"><span class="annottext">taskInfo' :: SQLiteHook -&gt; ContentHash -&gt; IO TaskInfo
</span><a href="Control.External.Coordinator.SQLite.html#taskInfo%27"><span class="hs-identifier hs-var hs-var">taskInfo'</span></a></span></span><span> </span><span id="local-6989586621679342536"><span class="annot"><span class="annottext">hook :: SQLiteHook
</span><a href="#local-6989586621679342536"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342535"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621679342534"><span class="annot"><span class="annottext">[SqlTaskInfo]
</span><a href="#local-6989586621679342534"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SQLiteHook -&gt; (Connection -&gt; IO [SqlTaskInfo]) -&gt; IO [SqlTaskInfo]
forall a. SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var">withSQLite</span></a></span><span> </span><span class="annot"><span class="annottext">SQLiteHook
</span><a href="#local-6989586621679342536"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">((Connection -&gt; IO [SqlTaskInfo]) -&gt; IO [SqlTaskInfo])
-&gt; (Connection -&gt; IO [SqlTaskInfo]) -&gt; IO [SqlTaskInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679342533"><span class="annot"><span class="annottext">conn :: Connection
</span><a href="#local-6989586621679342533"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [SqlTaskInfo]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.queryNamed</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342533"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><span class="hs-string">&quot;SELECT status, executor, elapsed, exit_code FROM tasks\
      \ WHERE\
      \  output = :output&quot;</span></span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[SqlTaskInfo]
</span><a href="#local-6989586621679342534"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TaskInfo -&gt; IO TaskInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TaskInfo
</span><a href="Control.External.Coordinator.html#UnknownTask"><span class="hs-identifier hs-var">UnknownTask</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679342529"><span class="annot"><span class="annottext">ti :: SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting SqlTaskStatus SqlTaskInfo SqlTaskStatus -&gt; SqlTaskStatus
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting SqlTaskStatus SqlTaskInfo SqlTaskStatus
Lens' SqlTaskInfo SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#stiStatus"><span class="hs-identifier hs-var">stiStatus</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-type">SqlPending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TaskInfo -&gt; IO TaskInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TaskInfo -&gt; IO TaskInfo) -&gt; TaskInfo -&gt; IO TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskStatus -&gt; TaskInfo
</span><a href="Control.External.Coordinator.html#KnownTask"><span class="hs-identifier hs-var">KnownTask</span></a></span><span> </span><span class="annot"><span class="annottext">TaskStatus
</span><a href="Control.External.Coordinator.html#Pending"><span class="hs-identifier hs-var">Pending</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlRunning"><span class="hs-identifier hs-type">SqlRunning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>        </span><span id="local-6989586621679342526"><span class="annot"><span class="annottext">SqlExecutor
</span><a href="#local-6989586621679342526"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; Maybe SqlExecutor -&gt; IO SqlExecutor
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var">fromMaybeField</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;executor&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting (Maybe SqlExecutor) SqlTaskInfo (Maybe SqlExecutor)
-&gt; Maybe SqlExecutor
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe SqlExecutor) SqlTaskInfo (Maybe SqlExecutor)
Lens' SqlTaskInfo (Maybe SqlExecutor)
</span><a href="Control.External.Coordinator.SQLite.html#stiExecutor"><span class="hs-identifier hs-var">stiExecutor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">TaskInfo -&gt; IO TaskInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TaskInfo -&gt; IO TaskInfo) -&gt; TaskInfo -&gt; IO TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskStatus -&gt; TaskInfo
</span><a href="Control.External.Coordinator.html#KnownTask"><span class="hs-identifier hs-var">KnownTask</span></a></span><span>
</span><span id="line-181"></span><span>          </span><span class="annot"><span class="annottext">(TaskStatus -&gt; TaskInfo) -&gt; TaskStatus -&gt; TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ExecutionInfo -&gt; TaskStatus
</span><a href="Control.External.Coordinator.html#Running"><span class="hs-identifier hs-var">Running</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="annot"><span class="annottext">$WExecutionInfo :: Executor -&gt; TimeSpec -&gt; ExecutionInfo
</span><a href="Control.External.Coordinator.html#%24WExecutionInfo"><span class="hs-identifier hs-type hs-type">ExecutionInfo</span></a></span><span>
</span><span id="line-183"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_eiExecutor :: Executor
</span><a href="Control.External.Coordinator.html#_eiExecutor"><span class="hs-identifier hs-var">_eiExecutor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExecutor -&gt; Executor
</span><a href="Control.External.Coordinator.SQLite.html#getSqlExecutor"><span class="hs-identifier hs-var hs-var">getSqlExecutor</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExecutor
</span><a href="#local-6989586621679342526"><span class="hs-identifier hs-var">executor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-184"></span><span>                </span><span class="annot"><span class="annottext">_eiElapsed :: TimeSpec
</span><a href="Control.External.Coordinator.html#_eiElapsed"><span class="hs-identifier hs-var">_eiElapsed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; TimeSpec
</span><a href="../file:///nix/store/azryzd3vkyvpasnzcshrfkxs2m455rhz-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">fromNanoSecs</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-185"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlCompleted"><span class="hs-identifier hs-type">SqlCompleted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>        </span><span id="local-6989586621679342519"><span class="annot"><span class="annottext">SqlExecutor
</span><a href="#local-6989586621679342519"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; Maybe SqlExecutor -&gt; IO SqlExecutor
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var">fromMaybeField</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;executor&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting (Maybe SqlExecutor) SqlTaskInfo (Maybe SqlExecutor)
-&gt; Maybe SqlExecutor
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe SqlExecutor) SqlTaskInfo (Maybe SqlExecutor)
Lens' SqlTaskInfo (Maybe SqlExecutor)
</span><a href="Control.External.Coordinator.SQLite.html#stiExecutor"><span class="hs-identifier hs-var">stiExecutor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>        </span><span id="local-6989586621679342518"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679342518"><span class="hs-identifier hs-var">elapsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; Maybe Integer -&gt; IO Integer
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var">fromMaybeField</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;elapsed&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting (Maybe Integer) SqlTaskInfo (Maybe Integer)
-&gt; Maybe Integer
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe Integer) SqlTaskInfo (Maybe Integer)
Lens' SqlTaskInfo (Maybe Integer)
</span><a href="Control.External.Coordinator.SQLite.html#stiElapsed"><span class="hs-identifier hs-var">stiElapsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">TaskInfo -&gt; IO TaskInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TaskInfo -&gt; IO TaskInfo) -&gt; TaskInfo -&gt; IO TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskStatus -&gt; TaskInfo
</span><a href="Control.External.Coordinator.html#KnownTask"><span class="hs-identifier hs-var">KnownTask</span></a></span><span>
</span><span id="line-190"></span><span>          </span><span class="annot"><span class="annottext">(TaskStatus -&gt; TaskInfo) -&gt; TaskStatus -&gt; TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ExecutionInfo -&gt; TaskStatus
</span><a href="Control.External.Coordinator.html#Completed"><span class="hs-identifier hs-var">Completed</span></a></span><span>
</span><span id="line-191"></span><span>            </span><span class="annot"><span class="annottext">$WExecutionInfo :: Executor -&gt; TimeSpec -&gt; ExecutionInfo
</span><a href="Control.External.Coordinator.html#%24WExecutionInfo"><span class="hs-identifier hs-type hs-type">ExecutionInfo</span></a></span><span>
</span><span id="line-192"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_eiExecutor :: Executor
</span><a href="Control.External.Coordinator.html#_eiExecutor"><span class="hs-identifier hs-var">_eiExecutor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExecutor -&gt; Executor
</span><a href="Control.External.Coordinator.SQLite.html#getSqlExecutor"><span class="hs-identifier hs-var hs-var">getSqlExecutor</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExecutor
</span><a href="#local-6989586621679342519"><span class="hs-identifier hs-var">executor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-193"></span><span>                </span><span class="annot"><span class="annottext">_eiElapsed :: TimeSpec
</span><a href="Control.External.Coordinator.html#_eiElapsed"><span class="hs-identifier hs-var">_eiElapsed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; TimeSpec
</span><a href="../file:///nix/store/azryzd3vkyvpasnzcshrfkxs2m455rhz-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">fromNanoSecs</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679342518"><span class="hs-identifier hs-var">elapsed</span></a></span><span>
</span><span id="line-194"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlFailed"><span class="hs-identifier hs-type">SqlFailed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>        </span><span id="local-6989586621679342516"><span class="annot"><span class="annottext">SqlExecutor
</span><a href="#local-6989586621679342516"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; Maybe SqlExecutor -&gt; IO SqlExecutor
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var">fromMaybeField</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;executor&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting (Maybe SqlExecutor) SqlTaskInfo (Maybe SqlExecutor)
-&gt; Maybe SqlExecutor
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe SqlExecutor) SqlTaskInfo (Maybe SqlExecutor)
Lens' SqlTaskInfo (Maybe SqlExecutor)
</span><a href="Control.External.Coordinator.SQLite.html#stiExecutor"><span class="hs-identifier hs-var">stiExecutor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span id="local-6989586621679342515"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679342515"><span class="hs-identifier hs-var">elapsed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; Maybe Integer -&gt; IO Integer
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var">fromMaybeField</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;elapsed&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting (Maybe Integer) SqlTaskInfo (Maybe Integer)
-&gt; Maybe Integer
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe Integer) SqlTaskInfo (Maybe Integer)
Lens' SqlTaskInfo (Maybe Integer)
</span><a href="Control.External.Coordinator.SQLite.html#stiElapsed"><span class="hs-identifier hs-var">stiElapsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span id="local-6989586621679342514"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342514"><span class="hs-identifier hs-var">exitCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; Text -&gt; Maybe Int -&gt; IO Int
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ContentHash -&gt; Text -&gt; Maybe a -&gt; m a
</span><a href="Control.External.Coordinator.SQLite.html#fromMaybeField"><span class="hs-identifier hs-var">fromMaybeField</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342535"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;exit_code&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlTaskInfo
</span><a href="#local-6989586621679342529"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskInfo
-&gt; Getting (Maybe Int) SqlTaskInfo (Maybe Int) -&gt; Maybe Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe Int) SqlTaskInfo (Maybe Int)
Lens' SqlTaskInfo (Maybe Int)
</span><a href="Control.External.Coordinator.SQLite.html#stiExitCode"><span class="hs-identifier hs-var">stiExitCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">TaskInfo -&gt; IO TaskInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TaskInfo -&gt; IO TaskInfo) -&gt; TaskInfo -&gt; IO TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskStatus -&gt; TaskInfo
</span><a href="Control.External.Coordinator.html#KnownTask"><span class="hs-identifier hs-var">KnownTask</span></a></span><span>
</span><span id="line-200"></span><span>          </span><span class="annot"><span class="annottext">(TaskStatus -&gt; TaskInfo) -&gt; TaskStatus -&gt; TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">ExecutionInfo -&gt; Int -&gt; TaskStatus
</span><a href="Control.External.Coordinator.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="annottext">$WExecutionInfo :: Executor -&gt; TimeSpec -&gt; ExecutionInfo
</span><a href="Control.External.Coordinator.html#%24WExecutionInfo"><span class="hs-identifier hs-type hs-type">ExecutionInfo</span></a></span><span>
</span><span id="line-202"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_eiExecutor :: Executor
</span><a href="Control.External.Coordinator.html#_eiExecutor"><span class="hs-identifier hs-var">_eiExecutor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SqlExecutor -&gt; Executor
</span><a href="Control.External.Coordinator.SQLite.html#getSqlExecutor"><span class="hs-identifier hs-var hs-var">getSqlExecutor</span></a></span><span> </span><span class="annot"><span class="annottext">SqlExecutor
</span><a href="#local-6989586621679342516"><span class="hs-identifier hs-var">executor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>                </span><span class="annot"><span class="annottext">_eiElapsed :: TimeSpec
</span><a href="Control.External.Coordinator.html#_eiElapsed"><span class="hs-identifier hs-var">_eiElapsed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; TimeSpec
</span><a href="../file:///nix/store/azryzd3vkyvpasnzcshrfkxs2m455rhz-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">fromNanoSecs</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679342515"><span class="hs-identifier hs-var">elapsed</span></a></span><span>
</span><span id="line-204"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>            </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342514"><span class="hs-identifier hs-var">exitCode</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Control.External.Coordinator.html#Coordinator"><span class="hs-identifier hs-type">Coordinator</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLite"><span class="hs-identifier hs-type">SQLite</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Config"><span class="annot"><a href="Control.External.Coordinator.html#Config"><span class="hs-identifier hs-var">Config</span></a></span></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLite"><span class="hs-identifier hs-type">SQLite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-type">Abs</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-type">Dir</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Hook"><span class="annot"><a href="Control.External.Coordinator.html#Hook"><span class="hs-identifier hs-var">Hook</span></a></span></span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLite"><span class="hs-identifier hs-type">SQLite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SQLiteHook"><span class="hs-identifier hs-type">SQLiteHook</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621679342503"><span class="annot"><span class="annottext">initialise :: Config SQLite -&gt; m (Hook SQLite)
</span><a href="Control.External.Coordinator.html#initialise"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialise</span></a></span></span><span> </span><span id="local-6989586621679342501"><span class="annot"><span class="annottext">dir :: Config SQLite
</span><a href="#local-6989586621679342501"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO SQLiteHook -&gt; m (Hook SQLite)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO SQLiteHook -&gt; m (Hook SQLite))
-&gt; IO SQLiteHook -&gt; m (Hook SQLite)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Path Abs Dir -&gt; IO ()
forall (m :: * -&gt; *) b. MonadIO m =&gt; Bool -&gt; Path b Dir -&gt; m ()
</span><a href="../file:///nix/store/pjkyiyv14csrfr5mybf8nkdqvh6awafi-path-io-lib-path-io-1.6.0-haddock-doc/share/doc/path-io/html/src"><span class="hs-identifier hs-var">createDirIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Path Abs Dir
Config SQLite
</span><a href="#local-6989586621679342501"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679342499"><span class="annot"><span class="annottext">Lock
</span><a href="#local-6989586621679342499"><span class="hs-identifier hs-var">lock</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path Abs Dir -&gt; IO Lock
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">openLock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path Abs Dir
Config SQLite
</span><a href="#local-6989586621679342501"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs Dir -&gt; Path Rel Dir -&gt; Path Abs Dir
forall b t. Path b Dir -&gt; Path Rel t -&gt; Path b t
</span><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="">[reldir|lock|]</span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">Lock -&gt; IO SQLiteHook -&gt; IO SQLiteHook
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; Lock -&gt; m a -&gt; m a
</span><a href="../../../../cas-store/html/src"><span class="hs-identifier hs-var">withLock</span></a></span><span> </span><span class="annot"><span class="annottext">Lock
</span><a href="#local-6989586621679342499"><span class="hs-identifier hs-var">lock</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SQLiteHook -&gt; IO SQLiteHook) -&gt; IO SQLiteHook -&gt; IO SQLiteHook
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>      </span><span id="local-6989586621679342495"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342495"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HostName -&gt; IO Connection
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.open</span></a></span><span> </span><span class="annot"><span class="annottext">(HostName -&gt; IO Connection) -&gt; HostName -&gt; IO Connection
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path Abs File -&gt; HostName
</span><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-identifier hs-var">fromAbsFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path Abs Dir
Config SQLite
</span><a href="#local-6989586621679342501"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">Path Abs Dir -&gt; Path Rel File -&gt; Path Abs File
forall b t. Path b Dir -&gt; Path Rel t -&gt; Path b t
</span><a href="../file:///nix/store/kw76r49hxg3500k9rzqvp9r3la2srkcy-path-lib-path-0.7.1-haddock-doc/share/doc/path/html/src"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="">[relfile|db.sqlite|]</span></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.execute_</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342495"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS\
        \  tasks\
        \  ( output TEXT PRIMARY KEY\
        \  , status INT NOT NULL\
        \  , executor TEXT\
        \  , elapsed INT\
        \  , exit_code INT\
        \  , task TEXT NOT NULL\
        \  )&quot;</span></span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="annottext">SQLiteHook -&gt; IO SQLiteHook
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-228"></span><span>        </span><span class="annot"><span class="annottext">SQLiteHook :: Connection -&gt; Lock -&gt; SQLiteHook
</span><a href="Control.External.Coordinator.SQLite.html#SQLiteHook"><span class="hs-identifier hs-type hs-type">SQLiteHook</span></a></span><span>
</span><span id="line-229"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_sqlConn :: Connection
</span><a href="Control.External.Coordinator.SQLite.html#_sqlConn"><span class="hs-identifier hs-var">_sqlConn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342495"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>            </span><span class="annot"><span class="annottext">_sqlLock :: Lock
</span><a href="Control.External.Coordinator.SQLite.html#_sqlLock"><span class="hs-identifier hs-var">_sqlLock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lock
</span><a href="#local-6989586621679342499"><span class="hs-identifier hs-var">lock</span></a></span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621679342490"><span class="annot"><span class="annottext">submitTask :: Hook SQLite -&gt; TaskDescription -&gt; m ()
</span><a href="Control.External.Coordinator.html#submitTask"><span class="hs-identifier hs-var hs-var hs-var hs-var">submitTask</span></a></span></span><span> </span><span id="local-6989586621679342488"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342488"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342487"><span class="annot"><span class="annottext">td :: TaskDescription
</span><a href="#local-6989586621679342487"><span class="hs-identifier hs-var">td</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">SQLiteHook -&gt; (Connection -&gt; IO ()) -&gt; IO ()
forall a. SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var">withSQLite</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342488"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">((Connection -&gt; IO ()) -&gt; IO ()) -&gt; (Connection -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621679342486"><span class="annot"><span class="annottext">conn :: Connection
</span><a href="#local-6989586621679342486"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeNamed</span></a></span><span>
</span><span id="line-237"></span><span>          </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342486"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-238"></span><span>          </span><span class="annot"><span class="hs-string">&quot;INSERT OR REPLACE INTO\
          \  tasks (output, status, task)\
          \ VALUES\
          \  (:output, :status, :task)&quot;</span></span><span>
</span><span id="line-242"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342487"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><span class="hs-string">&quot;:status&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-var">SqlPending</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>            </span><span class="annot"><span class="hs-string">&quot;:task&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlExternal -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalTask -&gt; SqlExternal
</span><a href="Control.External.Coordinator.SQLite.html#SqlExternal"><span class="hs-identifier hs-var">SqlExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342487"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ExternalTask TaskDescription ExternalTask
-&gt; ExternalTask
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ExternalTask TaskDescription ExternalTask
Lens' TaskDescription ExternalTask
</span><a href="Control.External.html#tdTask"><span class="hs-identifier hs-var">tdTask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621679342482"><span class="annot"><span class="annottext">queueSize :: Hook SQLite -&gt; m Int
</span><a href="Control.External.Coordinator.html#queueSize"><span class="hs-identifier hs-var hs-var hs-var hs-var">queueSize</span></a></span></span><span> </span><span id="local-6989586621679342480"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342480"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; m Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; m Int) -&gt; IO Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">[</span><span id="local-6989586621679342479"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679342479"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SQLiteHook -&gt; (Connection -&gt; IO [[Int]]) -&gt; IO [[Int]]
forall a. SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var">withSQLite</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342480"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">((Connection -&gt; IO [[Int]]) -&gt; IO [[Int]])
-&gt; (Connection -&gt; IO [[Int]]) -&gt; IO [[Int]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679342478"><span class="annot"><span class="annottext">conn :: Connection
</span><a href="#local-6989586621679342478"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>      </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [[Int]]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.queryNamed</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342478"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="hs-string">&quot;SELECT COUNT(*) FROM tasks WHERE status = :pending&quot;</span></span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;:pending&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-var">SqlPending</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; IO Int
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342479"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621679342477"><span class="annot"><span class="annottext">taskInfo :: Hook SQLite -&gt; ContentHash -&gt; m TaskInfo
</span><a href="Control.External.Coordinator.html#taskInfo"><span class="hs-identifier hs-var hs-var hs-var hs-var">taskInfo</span></a></span></span><span> </span><span id="local-6989586621679342475"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342475"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342474"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342474"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">IO TaskInfo -&gt; m TaskInfo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO TaskInfo -&gt; m TaskInfo) -&gt; IO TaskInfo -&gt; m TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><span class="annottext">SQLiteHook -&gt; ContentHash -&gt; IO TaskInfo
</span><a href="Control.External.Coordinator.SQLite.html#taskInfo%27"><span class="hs-identifier hs-var">taskInfo'</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342475"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342474"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621679342473"><span class="annot"><span class="annottext">popTask :: Hook SQLite -&gt; Executor -&gt; m (Maybe TaskDescription)
</span><a href="Control.External.Coordinator.html#popTask"><span class="hs-identifier hs-var hs-var hs-var hs-var">popTask</span></a></span></span><span> </span><span id="local-6989586621679342471"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342471"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342470"><span class="annot"><span class="annottext">executor :: Executor
</span><a href="#local-6989586621679342470"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe TaskDescription) -&gt; m (Maybe TaskDescription)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe TaskDescription) -&gt; m (Maybe TaskDescription))
-&gt; IO (Maybe TaskDescription) -&gt; m (Maybe TaskDescription)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">SQLiteHook
-&gt; (Connection -&gt; IO (Maybe TaskDescription))
-&gt; IO (Maybe TaskDescription)
forall a. SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var">withSQLite</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342471"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">((Connection -&gt; IO (Maybe TaskDescription))
 -&gt; IO (Maybe TaskDescription))
-&gt; (Connection -&gt; IO (Maybe TaskDescription))
-&gt; IO (Maybe TaskDescription)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621679342469"><span class="annot"><span class="annottext">conn :: Connection
</span><a href="#local-6989586621679342469"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Connection
-&gt; IO (Maybe TaskDescription) -&gt; IO (Maybe TaskDescription)
forall a. Connection -&gt; IO a -&gt; IO a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.withTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342469"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe TaskDescription) -&gt; IO (Maybe TaskDescription))
-&gt; IO (Maybe TaskDescription) -&gt; IO (Maybe TaskDescription)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621679342467"><span class="annot"><span class="annottext">[SqlTask]
</span><a href="#local-6989586621679342467"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [SqlTask]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.queryNamed</span></a></span><span>
</span><span id="line-264"></span><span>            </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342469"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-265"></span><span>            </span><span class="annot"><span class="hs-string">&quot;SELECT output, task FROM tasks\
            \ WHERE\
            \  status = :pending\
            \ LIMIT 1&quot;</span></span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;:pending&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-var">SqlPending</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[SqlTask]
</span><a href="#local-6989586621679342467"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TaskDescription -&gt; IO (Maybe TaskDescription)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe TaskDescription
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-272"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlTask"><span class="hs-identifier hs-type">SqlTask</span></a></span><span> </span><span id="local-6989586621679342466"><span class="annot"><span class="annottext">td :: TaskDescription
</span><a href="#local-6989586621679342466"><span class="hs-identifier hs-var">td</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>            </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeNamed</span></a></span><span>
</span><span id="line-274"></span><span>              </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342469"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-275"></span><span>              </span><span class="annot"><span class="hs-string">&quot;UPDATE tasks\
              \ SET\
              \  status = :status,\
              \  executor = :executor\
              \ WHERE\
              \  output = :output&quot;</span></span><span>
</span><span id="line-281"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;:status&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlRunning"><span class="hs-identifier hs-var">SqlRunning</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>                </span><span class="annot"><span class="hs-string">&quot;:executor&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlExecutor -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">Executor -&gt; SqlExecutor
</span><a href="Control.External.Coordinator.SQLite.html#SqlExecutor"><span class="hs-identifier hs-var">SqlExecutor</span></a></span><span> </span><span class="annot"><span class="annottext">Executor
</span><a href="#local-6989586621679342470"><span class="hs-identifier hs-var">executor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>                </span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342466"><span class="hs-identifier hs-var">td</span></a></span><span> </span><span class="annot"><span class="annottext">TaskDescription
-&gt; Getting ContentHash TaskDescription ContentHash -&gt; ContentHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContentHash TaskDescription ContentHash
Lens' TaskDescription ContentHash
</span><a href="Control.External.html#tdOutput"><span class="hs-identifier hs-var">tdOutput</span></a></span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>            </span><span class="annot"><span class="annottext">Maybe TaskDescription -&gt; IO (Maybe TaskDescription)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe TaskDescription -&gt; IO (Maybe TaskDescription))
-&gt; Maybe TaskDescription -&gt; IO (Maybe TaskDescription)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">TaskDescription -&gt; Maybe TaskDescription
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TaskDescription
</span><a href="#local-6989586621679342466"><span class="hs-identifier hs-var">td</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>  </span><span id="local-6989586621679342465"><span class="annot"><span class="annottext">awaitTask :: Hook SQLite -&gt; ContentHash -&gt; m TaskInfo
</span><a href="Control.External.Coordinator.html#awaitTask"><span class="hs-identifier hs-var hs-var hs-var hs-var">awaitTask</span></a></span></span><span> </span><span id="local-6989586621679342463"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342463"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342462"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342462"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO TaskInfo -&gt; m TaskInfo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO TaskInfo -&gt; m TaskInfo) -&gt; IO TaskInfo -&gt; m TaskInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO TaskInfo
</span><a href="#local-6989586621679342461"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-comment">-- XXX: SQLite has callback mechanisms built-in (e.g. @sqlite3_commit_hook@).</span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-comment">--   Unfortunately, @direct-sqlite@, which @sqlite-simple@ builds on top of,</span><span>
</span><span id="line-291"></span><span>      </span><span class="hs-comment">--   doesn't expose this functionality at the moment.</span><span>
</span><span id="line-292"></span><span>      </span><span id="local-6989586621679342461"><span class="annot"><span class="annottext">loop :: IO TaskInfo
</span><a href="#local-6989586621679342461"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">SQLiteHook -&gt; ContentHash -&gt; IO TaskInfo
</span><a href="Control.External.Coordinator.SQLite.html#taskInfo%27"><span class="hs-identifier hs-var">taskInfo'</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342463"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342462"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">IO TaskInfo -&gt; (TaskInfo -&gt; IO TaskInfo) -&gt; IO TaskInfo
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-294"></span><span>          </span><span class="annot"><a href="Control.External.Coordinator.html#KnownTask"><span class="hs-identifier hs-type">KnownTask</span></a></span><span> </span><span class="annot"><a href="Control.External.Coordinator.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679342460"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO TaskInfo -&gt; IO TaskInfo
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO TaskInfo
</span><a href="#local-6989586621679342461"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><a href="Control.External.Coordinator.html#KnownTask"><span class="hs-identifier hs-type">KnownTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.External.Coordinator.html#Running"><span class="hs-identifier hs-type">Running</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679342460"><span class="hs-identifier hs-var">sleep</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO TaskInfo -&gt; IO TaskInfo
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO TaskInfo
</span><a href="#local-6989586621679342461"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-296"></span><span>          </span><span id="local-6989586621679342459"><span class="annot"><span class="annottext">ti :: TaskInfo
</span><a href="#local-6989586621679342459"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TaskInfo -&gt; IO TaskInfo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TaskInfo
</span><a href="#local-6989586621679342459"><span class="hs-identifier hs-var">ti</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span id="local-6989586621679342460"><span class="annot"><span class="annottext">sleep :: IO ()
</span><a href="#local-6989586621679342460"><span class="hs-identifier hs-var hs-var">sleep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342458"><span class="hs-identifier hs-var">oneSeconds</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span id="local-6989586621679342458"><span class="annot"><span class="annottext">oneSeconds :: Int
</span><a href="#local-6989586621679342458"><span class="hs-identifier hs-var hs-var">oneSeconds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1000000</span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679342457"><span class="annot"><span class="annottext">updateTaskStatus :: Hook SQLite -&gt; ContentHash -&gt; TaskStatus -&gt; m ()
</span><a href="Control.External.Coordinator.html#updateTaskStatus"><span class="hs-identifier hs-var hs-var hs-var hs-var">updateTaskStatus</span></a></span></span><span> </span><span id="local-6989586621679342455"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342455"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679342454"><span class="annot"><span class="annottext">output :: ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679342453"><span class="annot"><span class="annottext">ts :: TaskStatus
</span><a href="#local-6989586621679342453"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><span class="annottext">SQLiteHook -&gt; (Connection -&gt; IO ()) -&gt; IO ()
forall a. SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var">withSQLite</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342455"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">((Connection -&gt; IO ()) -&gt; IO ()) -&gt; (Connection -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621679342452"><span class="annot"><span class="annottext">conn :: Connection
</span><a href="#local-6989586621679342452"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO () -&gt; IO ()
forall a. Connection -&gt; IO a -&gt; IO a
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.withTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342452"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>        </span><span id="local-6989586621679342451"><span class="annot"><span class="annottext">[[SqlTaskStatus]]
</span><a href="#local-6989586621679342451"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [[SqlTaskStatus]]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.queryNamed</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342452"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-306"></span><span>            </span><span class="annot"><span class="hs-string">&quot;SELECT status FROM tasks\
            \ WHERE\
            \  output = :output&quot;</span></span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[SqlTaskStatus]]
</span><a href="#local-6989586621679342451"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-311"></span><span>          </span><span class="hs-special">[</span><span class="annot"><a href="Control.External.Coordinator.SQLite.html#SqlRunning"><span class="hs-identifier hs-type">SqlRunning</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TaskStatus
</span><a href="#local-6989586621679342453"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-312"></span><span>            </span><span class="annot"><a href="Control.External.Coordinator.html#Completed"><span class="hs-identifier hs-type">Completed</span></a></span><span> </span><span id="local-6989586621679342450"><span class="annot"><span class="annottext">ei :: ExecutionInfo
</span><a href="#local-6989586621679342450"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>              </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeNamed</span></a></span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342452"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="hs-string">&quot;UPDATE tasks\
                \ SET\
                \  status = :completed,\
                \  elapsed = :elapsed\
                \ WHERE\
                \  output = :output&quot;</span></span><span>
</span><span id="line-321"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;:completed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlCompleted"><span class="hs-identifier hs-var">SqlCompleted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>                  </span><span class="annot"><span class="hs-string">&quot;:elapsed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; Integer
</span><a href="../file:///nix/store/azryzd3vkyvpasnzcshrfkxs2m455rhz-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">toNanoSecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecutionInfo
</span><a href="#local-6989586621679342450"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutionInfo
-&gt; Getting TimeSpec ExecutionInfo TimeSpec -&gt; TimeSpec
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TimeSpec ExecutionInfo TimeSpec
Lens' ExecutionInfo TimeSpec
</span><a href="Control.External.Coordinator.html#eiElapsed"><span class="hs-identifier hs-var">eiElapsed</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>                  </span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>            </span><span class="annot"><a href="Control.External.Coordinator.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621679342447"><span class="annot"><span class="annottext">ei :: ExecutionInfo
</span><a href="#local-6989586621679342447"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span id="local-6989586621679342446"><span class="annot"><span class="annottext">exitCode :: Int
</span><a href="#local-6989586621679342446"><span class="hs-identifier hs-var">exitCode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>              </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeNamed</span></a></span><span>
</span><span id="line-327"></span><span>                </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342452"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-328"></span><span>                </span><span class="annot"><span class="hs-string">&quot;UPDATE tasks\
                \ SET\
                \  status = :failed,\
                \  elapsed = :elapsed,\
                \  exit_code = :exit_code\
                \ WHERE\
                \  output = :output&quot;</span></span><span>
</span><span id="line-335"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;:failed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlFailed"><span class="hs-identifier hs-var">SqlFailed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-336"></span><span>                  </span><span class="annot"><span class="hs-string">&quot;:elapsed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; Integer
</span><a href="../file:///nix/store/azryzd3vkyvpasnzcshrfkxs2m455rhz-clock-lib-clock-0.8-haddock-doc/share/doc/clock/html/src"><span class="hs-identifier hs-var">toNanoSecs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecutionInfo
</span><a href="#local-6989586621679342447"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutionInfo
-&gt; Getting TimeSpec ExecutionInfo TimeSpec -&gt; TimeSpec
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/h794vsslldap0skagfwqgv01y2gd6kcd-lens-lib-lens-4.18.1-haddock-doc/share/doc/lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting TimeSpec ExecutionInfo TimeSpec
Lens' ExecutionInfo TimeSpec
</span><a href="Control.External.Coordinator.html#eiElapsed"><span class="hs-identifier hs-var">eiElapsed</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-337"></span><span>                  </span><span class="annot"><span class="hs-string">&quot;:exit_code&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679342446"><span class="hs-identifier hs-var">exitCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-338"></span><span>                  </span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-339"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><a href="Control.External.Coordinator.html#Pending"><span class="hs-identifier hs-type">Pending</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>              </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeNamed</span></a></span><span>
</span><span id="line-342"></span><span>                </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342452"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-343"></span><span>                </span><span class="annot"><span class="hs-string">&quot;UPDATE tasks\
                \ SET\
                \  status = :pending\
                \ WHERE\
                \  output = :output&quot;</span></span><span>
</span><span id="line-348"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;:pending&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-var">SqlPending</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-349"></span><span>                  </span><span class="annot"><span class="hs-string">&quot;:output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ContentHash -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-350"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>            </span><span class="annot"><a href="Control.External.Coordinator.html#Running"><span class="hs-identifier hs-type">Running</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLiteCoordinatorError -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/91yfmikxdcxwm4gzkl7lwamnf4wqc7z0-safe-exceptions-lib-safe-exceptions-0.1.7.0-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLiteCoordinatorError -&gt; IO ())
-&gt; SQLiteCoordinatorError -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; TaskStatus -&gt; SQLiteCoordinatorError
</span><a href="Control.External.Coordinator.SQLite.html#IllegalStatusUpdate"><span class="hs-identifier hs-var">IllegalStatusUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">TaskStatus
</span><a href="#local-6989586621679342453"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-352"></span><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLiteCoordinatorError -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/91yfmikxdcxwm4gzkl7lwamnf4wqc7z0-safe-exceptions-lib-safe-exceptions-0.1.7.0-haddock-doc/share/doc/safe-exceptions/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLiteCoordinatorError -&gt; IO ())
-&gt; SQLiteCoordinatorError -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContentHash -&gt; SQLiteCoordinatorError
</span><a href="Control.External.Coordinator.SQLite.html#NonRunningTask"><span class="hs-identifier hs-var">NonRunningTask</span></a></span><span> </span><span class="annot"><span class="annottext">ContentHash
</span><a href="#local-6989586621679342454"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>  </span><span id="local-6989586621679342445"><span class="annot"><span class="annottext">dropTasks :: Hook SQLite -&gt; m ()
</span><a href="Control.External.Coordinator.html#dropTasks"><span class="hs-identifier hs-var hs-var hs-var hs-var">dropTasks</span></a></span></span><span> </span><span id="local-6989586621679342443"><span class="annot"><span class="annottext">hook :: Hook SQLite
</span><a href="#local-6989586621679342443"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><span class="annottext">SQLiteHook -&gt; (Connection -&gt; IO ()) -&gt; IO ()
forall a. SQLiteHook -&gt; (Connection -&gt; IO a) -&gt; IO a
</span><a href="Control.External.Coordinator.SQLite.html#withSQLite"><span class="hs-identifier hs-var">withSQLite</span></a></span><span> </span><span class="annot"><span class="annottext">Hook SQLite
SQLiteHook
</span><a href="#local-6989586621679342443"><span class="hs-identifier hs-var">hook</span></a></span><span> </span><span class="annot"><span class="annottext">((Connection -&gt; IO ()) -&gt; IO ()) -&gt; (Connection -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-glyph">\</span><span id="local-6989586621679342442"><span class="annot"><span class="annottext">conn :: Connection
</span><a href="#local-6989586621679342442"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO ()
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-identifier hs-var">SQL.executeNamed</span></a></span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679342442"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-359"></span><span>          </span><span class="annot"><span class="hs-string">&quot;DELETE FROM tasks\
          \ WHERE\
          \  status = :pending&quot;</span></span><span>
</span><span id="line-362"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;:pending&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlTaskStatus -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><a href="../file:///nix/store/27p2mqminnv7fbwq4g0aqd48my2c61zz-sqlite-simple-lib-sqlite-simple-0.4.18.0-haddock-doc/share/doc/sqlite-simple/html/src"><span class="hs-operator hs-var">SQL.:=</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTaskStatus
</span><a href="Control.External.Coordinator.SQLite.html#SqlPending"><span class="hs-identifier hs-var">SqlPending</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-363"></span></pre></body></html>